<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ADS FUND - Your Investment Partner</title>
    <!-- Tailwind CSS CDN - Consider compiling for production for better performance -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Ensure html and body take at least full viewport height and allow scrolling */
        html, body {
            min-height: 100vh; /* Ensure it's at least the height of the viewport */
            height: auto; /* Allow content to push height beyond viewport if needed */
            overflow-x: hidden; /* Prevent horizontal scrolling */
        }
        body {
            font-family: 'Inter', sans-serif;
            scroll-behavior: smooth; /* Ensures smooth scrolling for anchor links */
            /* Subtle radial gradient background for the entire page */
            background-image: radial-gradient(circle at top left, #f0f8ff, #ffffff); /* Very light blue (aliceblue) to white */
            background-attachment: fixed;
        }

        /* Custom scrollbar for a cleaner look */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }

        /* Countdown Timer */
        .countdown-timer {
            font-size: 2.5rem;
            font-weight: bold;
            color: #fcd34d; /* yellow-300 */
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        /* Modal specific styles (for planDetailModal, messageModal, signInModal, signUpModal, investModal, termsAndConditionsModal) */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.4s ease-out, visibility 0.4s ease-out; /* Smoother transition */
        }
        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        .modal-content {
            background-color: white;
            padding: 2.5rem;
            border-radius: 1.5rem; /* rounded-3xl */
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
            max-width: 90%;
            width: 500px; /* Default width for most modals */
            position: relative;
            transform: translateY(-50px); /* Start further up */
            opacity: 0; /* Start invisible */
            transition: transform 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94), opacity 0.4s ease-out; /* Smoother easing */
            overflow-y: auto; /* Allow scrolling for taller modals */
            max-height: 90vh; /* Max height to fit within viewport */
        }
        /* Wider modal for investment form and terms */
        #investModal .modal-content,
        #signInModal .modal-content,
        #signUpModal .modal-content,
        #myInvestmentsModal .modal-content,
        #termsAndConditionsModal .modal-content,
        #investmentDetailsModal .modal-content,
        #referEarnModal .modal-content,
        #whereMoneyWorksModal .modal-content,
        #bankCardModal .modal-content,
        #paymentHistoryModal .modal-content,
        #whyChooseUsDetailModal .modal-content { /* Added paymentHistoryModal and whyChooseUsDetailModal here */
            width: 600px;
        }
        /* Specifically ensuring myInvestmentsModal content is plain white */
        #myInvestmentsModal .modal-content,
        #investmentDetailsModal .modal-content,
        #referEarnModal .modal-content,
        #whereMoneyWorksModal .modal-content,
        #bankCardModal .modal-content,
        #paymentHistoryModal .modal-content,
        #whyChooseUsDetailModal .modal-content { /* Ensure plain white for detail modal too */
            background-color: white;
            background-image: none;
        }


        .modal-overlay.active .modal-content {
            transform: translateY(0); /* Slide down to original position */
            opacity: 1; /* Fade in */
        }
        .modal-close-btn {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            font-size: 2rem;
            cursor: pointer;
            color: #4a5568; /* gray-700 */
            transition: color 0.2s ease-in-out;
        }
        .modal-close-btn:hover {
            color: #ef4444; /* red-500 */
            transform: rotate(90deg); /* Subtle rotate on close */
        }

        /* Common form styling within modals */
        .modal-content input[type="text"],
        .modal-content input[type="email"],
        .modal-content input[type="password"],
        .modal-content input[type="number"],
        .modal-content input[type="tel"],
        .modal-content select { /* Added select for consistent styling */
            width: calc(100% - 20px); /* Adjust for padding within the input */
            padding: 12px;
            margin: 10px 0;
            font-size: 1rem;
            border: 1px solid #cbd5e0; /* gray-300 */
            border-radius: 0.5rem; /* rounded-lg */
            box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.05);
            transition: border-color 0.3s ease-in-out, box-shadow 0.3s ease-in-out; /* Smoother transition */
            color: #2d3748;
        }

        .modal-content input:focus,
        .modal-content select:focus { /* Added select focus */
            border-color: #3b82f6; /* blue-500 */
            outline: none;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.25); /* blue-500 with alpha */
        }

        .modal-content label {
            display: block;
            text-align: left;
            width: calc(100% - 20px);
            margin-top: 10px;
            margin-bottom: 5px;
            font-weight: 600;
            color: #2d3748;
        }

        .modal-content button {
            padding: 0.875rem 2rem; /* py-3 px-6 */
            margin-top: 1.5rem; /* Spacing from inputs */
            font-size: 1rem;
            font-weight: 600; /* semibold */
            border-radius: 9999px; /* rounded-full */
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease-in-out; /* Consistent button transition */
            cursor: pointer;
            width: auto; /* Allow buttons to size naturally */
            display: inline-flex;
            justify-content: center;
            align-items: center;
        }

        .modal-content button[type="submit"] {
            background-color: #3b82f6; /* blue-500 */
            color: white;
        }

        .modal-content button[type="submit"]:hover {
            background-color: #2563eb; /* blue-600 */
            transform: translateY(-2px);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.2);
        }

        .modal-content button[type="submit"]:active {
            transform: translateY(0);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .modal-content .cancel-btn { /* Specific class for cancel buttons */
            background-color: #ef4444; /* red-500 */
            color: white;
            margin-left: 1rem; /* Spacing between buttons */
        }

        .modal-content .cancel-btn:hover {
            background-color: #dc2626; /* red-600 */
            transform: translateY(-2px);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.2);
        }

        .modal-content .cancel-btn:active {
            transform: translateY(0);
            box-shadow: 0 44px 6px rgba(0, 0, 0, 0.1);
        }


        /* Hero background image */
        .hero-background-image {
            background-image: url('https://wallpapercave.com/wp/wp13492660.png');
            background-size: cover; /* Cover the entire area */
            background-position: center; /* Center the image */
            background-repeat: no-repeat;
            position: absolute;
            inset: 0;
            z-index: 1; /* Below content, above glow */
        }

        /* Section reveal animation */
        .section-hidden {
            opacity: 0;
            transform: translateY(50px); /* Reduced initial offset for a smoother fade-in-up */
            transition: opacity 0.8s ease-out, transform 0.8s ease-out; /* Faster, smoother transition */
        }
        .section-visible {
            opacity: 1;
            transform: translateY(0);
        }

        /* Gradient Text for headings */
        .gradient-text-blue {
            background: linear-gradient(to right, #1d4ed8, #3b82f6); /* blue-700 to blue-500 */
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            color: transparent; /* Fallback for browsers not supporting -webkit-text-fill-color */
        }

        /* Pulsating effect for main CTA button */
        @keyframes pulse-once {
            0% { transform: scale(1); box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -2px rgba(0,0,0,0.05); }
            50% { transform: scale(1.03); box-shadow: 0 20px 25px -5px rgba(0,0,0,0.2), 0 10px 10px -5px rgba(0,0,0,0.04); }
            100% { transform: scale(1); box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -2px rgba(0,0,0,0.05); }
        }
        .cta-pulse {
            animation: pulse-once 2s ease-out; /* Run once on load, then can be repeated */
        }

        /* Enhanced card hover effects */
        .card-hover-effect {
            transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out, border-color 0.3s ease-in-out;
        }
        .card-hover-effect:hover {
            transform: translateY(-8px) scale(1.02); /* Lift and slight scale */
            box-shadow: 0 20px 25px -5px rgba(0,0,0,0.2), 0 10px 10px -5px rgba(0,0,0,0.04); /* Deeper shadow */
            border-color: var(--hover-border-color); /* Example: A slightly darker shade for purple */
        }

        /* Button hover/focus effects */
        .button-effect {
            transition: all 0.3s ease-in-out;
        }
        .button-effect:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 15px rgba(0,0,0,0.2);
        }
        .button-effect:active {
            transform: translateY(0);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        /* Floating animation for icons/emojis */
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-5px); }
            100% { transform: translateY(0px); }
        }
        .float-animation {
            animation: float 3s ease-in-out infinite;
        }

        /* Hero section overlay glow (adjusted to work with dynamic background) */
        @keyframes hero-glow {
            0% { background-color: rgba(255, 255, 255, 0); }
            50% { background-color: rgba(255, 255, 255, 0.05); }
            100% { background-color: rgba(255, 255, 255, 0); }
        }
        .hero-overlay-glow {
            position: absolute;
            inset: 0;
            background-color: rgba(255, 255, 255, 0);
            animation: hero-glow 18s ease-in-out infinite alternate; /* Longer duration for subtler glow */
            z-index: 2; /* Ensure it's above the dynamic background */
        }

        /* Text stroke for Hero Section */
        .hero-text-stroke {
            text-shadow: 2px 2px 8px rgba(0,0,0,0.9), 0 0 10px rgba(0,0,0,0.5); /* Stronger black stroke/shadow */
        }

        .form-group {
            margin-bottom: 1.5rem; /* Increased spacing between form groups */
        }

        .form-input-field, .form-textarea-field {
            display: block;
            width: 100%;
            padding: 0.75rem 1rem; /* More padding */
            font-size: 1rem;
            line-height: 1.5;
            color: #4a5568; /* gray-700 */
            background-color: #f8fafc; /* light blue-gray */
            background-clip: padding-box;
            border: 1px solid #e2e8f0; /* gray-200 */
            border-radius: 0.75rem; /* rounded-lg */
            box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.05); /* subtle inset shadow */
            color: #2d3748;
            transition: border-color 0.3s ease-in-out, box-shadow 0.3s ease-in-out; /* Smoother transition */
        }

        .form-input-field:focus, .form-textarea-field:focus {
            color: #1a202c; /* dark gray */
            background-color: #fff;
            border-color: #3b82f6; /* blue-500 */
            outline: 0;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.25); /* blue-500 with alpha */
        }

        .form-label {
            display: block;
            text-align: left;
            width: calc(100% - 20px);
            margin-top: 10px;
            margin-bottom: 5px;
            font-weight: 600;
            color: #2d3748;
        }

        .form-submit-btn {
            background-color: #3b82f6; /* blue-500 */
            color: white;
            font-weight: bold;
            padding: 0.875rem 2rem; /* py-3 px-6 */
            border-radius: 9999px; /* rounded-full */
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease-in-out;
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .form-submit-btn:hover {
            background-color: #2563eb; /* blue-600 */
            transform: translateY(-2px);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.2);
        }

        .form-submit-btn:active {
            transform: translateY(0);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        /* Fade animation for form messages */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes fadeOut {
            from { opacity: 1; transform: translateY(0); }
            to { opacity: 0; transform: translateY(10px); }
        }

        .form-message-success, .form-message-error {
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            margin-top: 1rem;
            text-align: center;
            font-weight: 500;
            animation: fadeIn 0.5s ease-out forwards; /* Fade in when displayed */
        }

        .form-message-success {
            background-color: #d1fae5; /* green-100 */
            color: #065f46; /* green-800 */
        }

        .form-message-error {
            background-color: #fee2e2; /* red-100 */
            color: #991b1b; /* red-800 */
        }

        .form-message.fade-out {
            animation: fadeOut 0.5s ease-in forwards; /* Fade out when hidden */
        }

        /* Plan Card Specific Styles */
        .plan-card {
            position: relative;
            overflow: hidden;
            background-image: linear-gradient(to bottom right, #fdfdfd, #f0f0f0); /* Subtle light gradient */
            padding: 2rem; /* Adjusted from p-8 (2.5rem) to 2rem */
        }

        .plan-card.standard-plan {
            border-top: 8px solid #3b82f6; /* blue-500 */
            background-image: linear-gradient(to bottom right, #e0f7fa, #bbdefb); /* Light blue to a slightly darker blue */
        }

        .plan-card.premium-plan {
            border-top: 8px solid #8b5cf6; /* purple-500 */
            background-image: linear-gradient(to bottom right, #ede7f6, #d1c4e9); /* Light purple to a slightly darker purple */
        }

        .plan-card.elite-plan {
            border-top: 8px solid #f59e0b; /* yellow-500 */
            background-image: linear-gradient(to bottom right, #fffde7, #fff59d); /* Light yellow to a slightly darker yellow */
        }

        /* Enhanced hover effects for plan cards */
        .plan-card:hover {
            transform: translateY(-10px) scale(1.03);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.3); /* Deeper shadow on hover */
            border-color: var(--hover-border-color); /* Dynamic border color */
        }
        .plan-card.standard-plan:hover { --hover-border-color: #1d4ed8; } /* darker blue */
        .plan-card.premium-plan:hover { --hover-border-color: #6d28d9; } /* darker purple */
        .plan-card.elite-plan:hover { --hover-border-color: #d97706; } /* darker yellow */

        /* Plan card icon styling */
        .plan-icon-wrapper {
            background-color: rgba(255, 255, 255, 0.8);
            border-radius: 50%;
            padding: 0.8rem; /* Slightly reduced padding */
            display: inline-flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            margin-bottom: 1rem; /* Reduced from 1.5rem to 1rem */
        }
        .plan-icon {
            font-size: 2.5rem; /* Slightly smaller icon size */
            line-height: 1;
        }

        /* New tag for plans */
        .plan-tag {
            position: absolute;
            top: 0.75rem; /* Adjusted from 1rem */
            right: 0.75rem; /* Adjusted from 1rem */
            background-color: #ef4444; /* red-500 */
            color: white;
            padding: 0.2rem 0.6rem; /* Slightly smaller padding */
            border-radius: 0.4rem; /* Slightly smaller border-radius */
            font-weight: bold;
            font-size: 0.8rem; /* Slightly smaller font size */
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            animation: pulse-tag 1.5s infinite ease-in-out alternate;
        }

        @keyframes pulse-tag {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.05); opacity: 0.9; }
            100% { transform: scale(1); opacity: 1; }
        }

        /* Text adjustments for compactness */
        .plan-card h3 {
            margin-bottom: 0.75rem; /* Adjusted from 1rem */
        }
        .plan-card .text-lg.mb-4 {
            margin-bottom: 0.75rem; /* Adjusted from 1rem */
        }
        .plan-card .block.text-2xl.font-semibold.mb-1 {
            margin-bottom: 0.25rem; /* Adjusted from 0.5rem */
        }
        .plan-card .border-t.pt-4 {
            padding-top: 0.75rem; /* Adjusted from 1rem */
        }
        .plan-card h4.text-xl.mb-2 {
            margin-bottom: 0.5rem; /* Adjusted from 0.75rem */
        }

        /* New: Animation for plan cards when "Explore Our Plans" is clicked */
        @keyframes card-initial-pop {
            0% { transform: translateY(0) scale(1); opacity: 0.8; }
            25% { transform: translateY(-5px) scale(1.01); opacity: 1; }
            50% { transform: translateY(0) scale(1); opacity: 1; }
            75% { transform: translateY(-2px) scale(1.005); opacity: 1; }
            100% { transform: translateY(0) scale(1); opacity: 1; }
        }
        .animate-card-pop {
            animation: card-initial-pop 0.8s ease-out forwards; /* Run once, then stay */
        }

        /* Styles for "My Investments" summary cards within modal */
        .investment-summary-card {
            background-color: white;
            border-left: 8px solid; /* Color set dynamically */
            border-radius: 0.75rem;
            padding: 1.5rem;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 1.1rem;
            font-weight: 600;
            color: #2d3748;
        }

        .investment-summary-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.2);
        }

        .investment-summary-card .plan-name {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1e3a8a;
        }
        .investment-summary-card .invest-date {
            font-size: 0.9rem;
            font-weight: 500;
            color: #6b7280;
            text-align: right;
        }
        .investment-summary-card .arrow-icon {
            font-size: 1.8rem;
            color: #3b82f6; /* blue-500 */
            margin-left: 1rem;
        }

        /* Specific border colors for investment summary cards */
        .investment-summary-card.standard-plan-item { border-color: #3b82f6; } /* blue-500 */
        .investment-summary-card.premium-plan-item { border-color: #8b5cf6; } /* purple-500 */
        .investment-summary-card.elite-plan-item { border-color: #f59e0b; } /* yellow-500 */


        /* Styles for Investment Details Modal content */
        .investment-details-group,
        .financial-details-group {
            margin-bottom: 1rem; /* Space between groups of details */
            padding: 0.75rem 1rem; /* Padding for the entire group */
            border-radius: 0.5rem;
            background-color: white; /* Changed to solid white */
            background-image: none; /* Ensure no gradient */
            box-shadow: 0 2px 5px rgba(0,0,0,0.05); /* Subtle shadow for the group */
        }

        .investment-details-group p,
        .financial-details-group p {
            display: flex; /* Keep flex for icon + text */
            align-items: center; /* Align items vertically in the center */
            padding: 0.25rem 0; /* Vertical padding for each line */
            border-bottom: 1px dashed rgba(0,0,0,0.1); /* Subtle dashed separator */
            font-size: 1.05rem; /* Slightly larger font for details */
            color: #374151; /* Default text color for details */
            flex-wrap: wrap; /* Allow content to wrap */
        }

        .investment-details-group p:last-child,
        .financial-details-group p:last-child {
            border-bottom: none; /* No border for the last item in a group */
        }

        .investment-details-group p span:first-child,
        .financial-details-group p span:first-child {
            font-weight: 500; /* Medium weight for labels */
            margin-right: 0.5rem; /* Small gap between label and value */
        }

        .investment-details-group p strong,
        .financial-details-group p strong {
            font-weight: 600; /* Semibold for values */
            color: #1a202c; /* Darker color for values for emphasis */
            word-break: break-word; /* Ensure long words break and wrap within the element */
            flex-basis: auto; /* Allow content to determine its width */
            flex-shrink: 0; /* Prevent shrinking too much */
        }

        /* Specific colors for financial values for quick identification */
        .investment-details-group .text-blue-700 { color: #1d4ed8; } /* Invested amount */
        .investment-details-group .text-green-700 { color: #047857; } /* Payouts and returns */
        .investment-details-group .text-gray-800 { color: #2d3748; } /* Dates, UTR, etc. */


        /* Style for UPI copy buttons */
        .copy-upi-btn {
            background-color: #28a745; /* Green */
            color: white;
            padding: 0.3rem 0.8rem;
            border-radius: 0.5rem;
            font-size: 0.8rem;
            margin-left: 0.5rem;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .copy-upi-btn:hover {
            background-color: #218838;
        }

        /* Terms and Conditions checkbox and link styling */
        .terms-checkbox-group {
            display: flex;
            align-items: center;
            margin-top: 1.5rem;
            margin-bottom: 1.5rem;
            width: calc(100% - 20px); /* Match input width */
        }

        .terms-checkbox-group input[type="checkbox"] {
            margin-right: 0.75rem;
            transform: scale(1.2); /* Slightly larger checkbox */
            cursor: pointer;
        }

        .terms-checkbox-group label {
            display: inline-block;
            margin: 0; /* Override default label margin */
            font-weight: 500;
            color: #4a5568;
            cursor: pointer;
        }

        .terms-link {
            color: #3b82f6; /* blue-500 */
            text-decoration: underline;
            transition: color 0.2s ease;
        }

        .terms-link:hover {
            color: #2563eb; /* blue-600 */
        }

        /* Referred User Card Styles */
        .referred-user-card {
            background-color: #f8fafc; /* Light blue-gray */
            border: 1px solid #e2e8f0; /* gray-200 */
            border-radius: 0.75rem;
            padding: 1rem;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            transition: all 0.2s ease-in-out;
            display: flex;
            flex-direction: column; /* Stack details vertically */
            align-items: flex-start; /* Align text to the left */
            font-size: 1rem;
            color: #2d3748;
        }

        .referred-user-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 10px rgba(0,0,0,0.1);
        }

        .referred-user-card p {
            margin: 0;
            padding: 0;
            line-height: 1.4;
        }

        .referred-user-card .referred-user-id-text {
            font-weight: 600;
            color: #1d4ed8; /* blue-700 */
        }

        .referred-user-card .text-xs {
            color: #6b7280; /* gray-500 */
        }

        /* Styles for disabled buttons */
        .button-disabled {
            opacity: 0.6;
            cursor: not-allowed;
            pointer-events: none; /* Prevent click events */
        }

        /* New: Dynamic Header Text Styling */
        #dynamicHeaderText {
            font-size: 1.5rem; /* Adjusted for better fit in header */
            font-weight: 600;
            color: #fcd34d; /* yellow-300 */
            text-shadow: 1px 1px 3px rgba(0,0,0,0.5);
            text-align: center;
            flex-grow: 1; /* Allow it to take available space */
            margin: 0 1rem; /* Add some horizontal margin */
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
        }
        #dynamicHeaderText.active {
            opacity: 1;
        }

        /* New: Styles for Where Your Money Works Modal (Re-designed) */
        #whereMoneyWorksModal .modal-content {
            background-image: linear-gradient(to bottom right, #e0f7fa, #bbdefb); /* Light blue gradient */
            padding: 2.5rem;
            border-radius: 1.5rem;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
            max-width: 700px; /* Wider for better content display */
            width: 90%;
            text-align: center;
        }

        #whereMoneyWorksModal .modal-content h2 {
            color: #1d4ed8; /* Darker blue for modal title */
            font-size: 2.5rem;
            margin-bottom: 1.5rem; /* Reduced margin */
        }

        #whereMoneyWorksModal .modal-content .intro-text {
            font-size: 1.15rem;
            color: #374151;
            margin-bottom: 2.5rem; /* Increased margin below intro */
            line-height: 1.7;
        }

        #whereMoneyWorksModal .modal-content .info-card {
            background-color: white;
            border-radius: 1rem;
            padding: 2rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            margin-bottom: 1.5rem;
            transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
            border-bottom: 5px solid; /* For accent color */
            text-align: left; /* Align text left within cards */
        }

        #whereMoneyWorksModal .modal-content .info-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
        }

        #whereMoneyWorksModal .modal-content .info-card.market-card {
            border-color: #047857; /* Green for market */
        }

        #whereMoneyWorksModal .modal-content .info-card.lending-card {
            border-color: #3b82f6; /* Blue for lending */
        }

        #whereMoneyWorksModal .modal-content .info-card .icon {
            font-size: 3.5rem;
            margin-bottom: 1rem;
            color: #1e3a8a;
            text-align: center; /* Center icon within card */
            display: block; /* Make icon a block element for centering */
        }

        #whereMoneyWorksModal .modal-content h3 {
            font-size: 1.8rem;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 0.75rem;
            text-align: center; /* Center heading within card */
        }

        #whereMoneyWorksModal .modal-content p {
            font-size: 1.05rem;
            color: #4a5568;
            line-height: 1.6;
            margin-bottom: 1rem; /* Space between paragraphs */
        }

        #whereMoneyWorksModal .modal-content ul {
            list-style: disc;
            list-style-position: inside;
            padding-left: 1.25rem; /* Indent list items */
            color: #4a5568;
            font-size: 1rem;
        }
        #whereMoneyWorksModal .modal-content ul li {
            margin-bottom: 0.5rem;
        }
        #whereMoneyWorksModal .modal-content ul li:last-child {
            margin-bottom: 0;
        }

        #whereMoneyWorksModal .modal-content .conclusion-text {
            font-size: 1.1rem;
            color: #374151;
            margin-top: 2rem;
            line-height: 1.6;
        }

        /* NEW: Animation for glowing text */
        @keyframes text-glow {
            0% { text-shadow: 0 0 5px rgba(255, 255, 255, 0.5), 0 0 10px rgba(255, 255, 255, 0.3); }
            50% { text-shadow: 0 0 10px rgba(255, 255, 255, 0.8), 0 0 20px rgba(255, 255, 255, 0.6), 0 0 30px rgba(255, 255, 255, 0.4); }
            100% { text-shadow: 0 0 5px rgba(255, 255, 255, 0.5), 0 0 10px rgba(255, 255, 255, 0.3); }
        }

        #limited-time-offer .offer-text-glow {
            animation: text-glow 2s ease-in-out infinite alternate;
        }

        #limited-time-offer .bonus-highlight {
            font-size: 1.5em; /* Make bonus text even larger */
            font-weight: 900; /* Extra bold */
            color: #00ffff; /* Bright electric blue */
            text-shadow: 0 0 8px rgba(0, 255, 255, 0.8), 0 0 15px rgba(0, 255, 255, 0.6); /* Stronger blue glow */
            display: inline-block; /* Ensure text-shadow applies correctly */
        }

        /* NEW: Styles for Payment History Modal */
        #paymentHistoryModal .modal-content {
            background-image: linear-gradient(to bottom right, #f8fafc, #e2e8f0); /* Light gray gradient */
            padding: 2.5rem;
            border-radius: 1.5rem;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
            max-width: 700px;
            width: 90%;
            text-align: center;
        }

        #paymentHistoryModal .modal-content h2 {
            color: #1d4ed8;
            font-size: 2.5rem;
            margin-bottom: 1.5rem;
        }

        #paymentHistoryModal .payment-item {
            background-color: white;
            border-radius: 0.75rem;
            padding: 1.5rem;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 1rem;
            text-align: left;
            border-left: 6px solid #3b82f6; /* Blue accent */
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }

        #paymentHistoryModal .payment-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.15);
        }

        #paymentHistoryModal .payment-item p {
            margin-bottom: 0.5rem;
            font-size: 1rem;
            color: #374151;
        }

        #paymentHistoryModal .payment-item p strong {
            color: #1a202c;
        }

        #paymentHistoryModal .payment-item .amount {
            font-size: 1.3rem;
            font-weight: 700;
            color: #047857; /* Green for amount */
        }

        #paymentHistoryModal .payment-item .date-time {
            font-size: 0.9rem;
            color: #6b7280;
            text-align: right;
            margin-top: 0.5rem;
        }

        /* NEW: UPI App Buttons and QR Code Container */
        .upi-payment-options {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1rem;
            margin-top: 1.5rem;
            margin-bottom: 2rem;
            padding: 1.5rem;
            background-color: #f0f8ff; /* Light blue background */
            border-radius: 1rem;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.05);
        }

        .upi-app-button {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            padding: 0.75rem 1.5rem;
            border-radius: 9999px; /* Full rounded */
            font-weight: 600;
            color: white;
            transition: all 0.3s ease-in-out;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            cursor: pointer;
        }

        .upi-app-button img {
            width: 24px;
            height: 24px;
            margin-right: 0.75rem;
        }

        .upi-app-button.gpay { background-color: #4285F4; } /* Google Blue */
        .upi-app-button.gpay:hover { background-color: #3367D6; transform: translateY(-2px); box-shadow: 0 6px 10px rgba(0,0,0,0.15); }
        .upi-app-button.phonepe { background-color: #6739B7; } /* PhonePe Purple */
        .upi-app-button.phonepe:hover { background-color: #582DA0; transform: translateY(-2px); box-shadow: 0 6px 10px rgba(0,0,0,0.15); }
        .upi-app-button.paytm { background-color: #00B9F1; } /* Paytm Blue */
        .upi-app-button.paytm:hover { background-color: #0099CC; transform: translateY(-2px); box-shadow: 0 6px 10px rgba(0,0,0,0.15); }

        .qr-code-container {
            text-align: center;
            margin-top: 1.5rem;
            padding: 1rem;
            background-color: white;
            border-radius: 0.75rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .qr-code-container img {
            width: 180px;
            height: 180px;
            border: 1px solid #e2e8f0;
            border-radius: 0.5rem;
        }
        .qr-code-container p {
            font-size: 0.9rem;
            color: #6b7280;
            margin-top: 0.5rem;
        }
        /* Specific styling for the manual UPI ID display in the invest modal */
        .manual-upi-display {
            background-color: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 0.5rem;
            padding: 0.75rem;
            margin-top: 1rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: 0.95rem;
            color: #2d3748;
            word-break: break-all; /* Ensure long UPI IDs wrap */
        }
        .manual-upi-display .upi-id-text {
            font-family: monospace;
            font-weight: 600;
            color: #1d4ed8;
            flex-grow: 1;
            text-align: center;
            padding-right: 0.5rem;
        }
        .manual-upi-display .copy-btn-small {
            background-color: #28a745;
            color: white;
            padding: 0.2rem 0.6rem;
            border-radius: 0.3rem;
            font-size: 0.75rem;
            cursor: pointer;
            transition: background-color 0.2s ease;
            flex-shrink: 0;
        }
        .manual-upi-display .copy-btn-small:hover {
            background-color: #218838;
        }

        /* Styles for Why Choose Us Buttons */
        .why-choose-us-button {
            background-color: white;
            border-radius: 2rem; /* More rounded */
            padding: 2rem; /* Increased padding */
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1); /* Deeper shadow */
            transform: translateY(0);
            transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out, border-color 0.3s ease-in-out;
            border-bottom: 6px solid; /* For accent color */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            text-align: center;
            width: 100%; /* Ensure they take full grid column width */
            height: 100%; /* Ensure consistent height in grid */
        }

        .why-choose-us-button:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 25px 40px rgba(0, 0, 0, 0.2);
        }

        .why-choose-us-button.high-returns { border-color: #047857; /* green-700 */ }
        .why-choose-us-button.special-offers { border-color: #d97706; /* orange-700 */ }
        .why-choose-us-button.security-trust { border-color: #0d9488; /* teal-700 */ }

        .why-choose-us-button .icon-wrapper {
            font-size: 3.5rem; /* Larger icon */
            margin-bottom: 1rem;
        }

        .why-choose-us-button h3 {
            font-size: 2rem; /* Larger heading */
            font-weight: 700; /* Bolder */
            color: #1d4ed8; /* blue-700 */
            margin-bottom: 0.75rem;
        }

        .why-choose-us-button p {
            font-size: 1.1rem; /* Larger paragraph text */
            color: #4a5568; /* gray-700 */
            line-height: 1.6;
        }

        /* Why Choose Us Detail Modal Specific Styles */
        #whyChooseUsDetailModal .modal-content {
            background-image: linear-gradient(to bottom right, #f0f9ff, #e0f2fe); /* Light blue gradient */
            padding: 2.5rem;
            border-radius: 1.5rem;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
            max-width: 600px;
            width: 90%;
            text-align: center;
        }

        #whyChooseUsDetailModal .modal-content h2 {
            color: #1d4ed8;
            font-size: 2.5rem;
            margin-bottom: 1.5rem;
        }

        #whyChooseUsDetailModal .modal-content p {
            font-size: 1.15rem;
            color: #374151;
            line-height: 1.7;
        }
        /* Style for ul within whyChooseUsDetailModal */
        #whyChooseUsDetailModal .modal-content ul {
            list-style: disc;
            list-style-position: inside;
            padding-left: 1.25rem; /* Indent list items */
            color: #4a5568;
            font-size: 1.05rem; /* Slightly smaller than p for list items */
            text-align: left; /* Align list items left */
            margin-top: 1rem; /* Space above list */
            margin-bottom: 1rem; /* Space below list */
        }
        #whyChooseUsDetailModal .modal-content ul li {
            margin-bottom: 0.5rem;
        }
        #whyChooseUsDetailModal .modal-content ul li:last-child {
            margin-bottom: 0;
        }

    </style>
</head>
<body>

    <!-- Header Section -->
    <header class="bg-gradient-to-r from-blue-700 to-indigo-800 text-white shadow-lg py-4 fixed w-full z-10">
        <div class="container mx-auto px-6 flex justify-between items-center">
            <!-- Left side: Logo and Membership Status (now stacked) -->
            <div class="flex flex-col items-start space-y-1">
                <div class="flex items-center space-x-3">
                    <!-- Original SVG Logo -->
                    <svg class="w-10 h-10 text-yellow-300" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                        <!-- A stylized 'A' for ADS with an upward arrow to represent growth -->
                        <path d="M12 2L2 22H5.5L12 8.3L18.5 22H22L12 2ZM12 5.6L14.7 11.2H9.3L12 5.6Z" fill="#ffeb3b"/>
                        <!-- A simple 'D' like shape for diversification/development -->
                        <path d="M19 12C19 15.866 15.866 19 12 19C8.13401 19 5 15.866 5 12C5 8.13401 8.13401 5 12 5H19V12ZM12 7C9.23858 7 7 9.23858 7 12C7 14.7614 9.23858 17 12 17C14.7614 17 17 14.7614 17 12H12V7Z" fill="#81c784"/>
                        <!-- A simple 'S' for security/stability -->
                        <path d="M17 6C14.7909 6 13 7.79086 13 10C13 12.2091 14.7909 14 17 14C19.2091 14 21 12.2091 21 10H17V6Z" fill="#ffa726"/>
                        <path d="M7 18C9.20914 18 11 16.2091 11 14C11 11.7909 9.20914 10 7 10C4.79086 10 3 11.7909 3 14H7V18Z" fill="#42a5f5"/>
                    </svg>

                    <a href="#" class="text-3xl font-bold tracking-tight">ADS FUND</a>
                </div>
                <!-- Membership Status - now always visible, stacked below logo/text -->
                <span id="userMembershipStatus" class="text-sm font-semibold text-green-300 ml-1"></span>
            </div>

            <!-- Dynamic Motivational Text for Desktop & Mobile -->
            <div id="dynamicHeaderText" class="flex-grow text-xl md:text-2xl font-semibold text-yellow-300 text-center">
                <!-- Text will be inserted by JavaScript -->
            </div>

            <nav class="hidden md:block">
                <ul class="flex space-x-8 text-lg font-medium">
                    <!-- Conditional Navigation based on Auth status -->
                    <li id="navAuthLinks" class="flex space-x-8">
                        <!-- Content managed by JavaScript based on auth state -->
                    </li>
                </ul>
            </nav>
            <div class="md:hidden flex-shrink-0"> <!-- Added flex-shrink-0 for mobile menu button -->
                <button id="mobileMenuButton" class="text-white focus:outline-none">
                    <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                    </svg>
                </button>
            </div>
        </div>
        <!-- Mobile Menu Overlay -->
        <div id="mobileMenu" class="hidden md:hidden fixed inset-0 bg-blue-800 bg-opacity-95 z-50 flex flex-col items-center justify-center space-y-8 text-2xl font-bold transition-opacity duration-300 ease-in-out opacity-0">
            <button id="closeMobileMenuButton" class="absolute top-6 right-6 text-white text-4xl focus:outline-none">&times;</button>
            <ul class="flex flex-col items-center space-y-6">
                <li><a href="#plans" class="hover:text-yellow-300 transition duration-300" data-close-menu>Investment Plans</a></li>
                <li><a href="#how-it-works" class="hover:text-yellow-300 transition duration-300" data-close-menu>How It Works</a></li>
                <li><a href="#why-choose-us" class="hover:text-yellow-300 transition duration-300" data-close-menu>Why Choose Us</a></li>
                <!-- Removed direct link to Where Your Money Works from mobile menu -->
                <li><a href="#limited-time-offer" class="hover:text-yellow-300 transition duration-300" data-close-menu>Special Offer</a></li>
                <li><a href="#ai-calculator" class="hover:text-yellow-300 transition duration-300" data-close-menu>AI Calculator</a></li>
                <!-- Conditional Mobile Nav Links -->
                <li id="mobileNavAuthLinks" class="flex flex-col items-center space-y-6">
                    <!-- Content managed by JavaScript based on auth state -->
                </li>
            </ul>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="relative text-white flex items-center justify-center min-h-screen pt-24">
        <!-- New: Background image -->
        <div class="hero-background-image"></div>
        <div class="container mx-auto px-6 py-20 text-center relative z-10">
            <h1 class="text-5xl md:text-6xl font-extrabold leading-tight mb-6 hero-text-stroke">
                Welcome to <span class="text-yellow-300">ADS FUND</span>
            </h1>
            <p class="text-3xl md:text-4xl font-semibold mb-4 text-white hero-text-stroke">Aspire. Develop. Secure.</p>
            <p class="text-xl md:text-2xl mb-10 max-w-3xl mx-auto hero-text-stroke">
                Where your investments fuel growth and secure a prosperous financial future.
                We're dedicated to delivering consistent returns, fostering trust, and building long-term success together.
            </p>
            <div class="flex flex-col sm:flex-row justify-center items-center space-y-4 sm:space-y-0 sm:space-x-6">
                <a href="#plans" id="explorePlansBtn" class="bg-yellow-400 hover:bg-yellow-500 text-blue-900 font-bold py-3 px-8 rounded-full shadow-lg transform transition duration-300 hover:scale-105 inline-block cta-pulse button-effect">
                    Explore Our Plans
                </a>
                <!-- New: Learn More about Where Your Money Works button -->
                <button id="learnMoreMoneyWorksBtn" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-8 rounded-full shadow-lg transform transition duration-300 hover:scale-105 inline-block button-effect">
                    Where Your Money Works
                </button>
            </div>
        </div>
    </section>

    <!-- Investment Plans Section -->
    <section id="plans" class="py-20 bg-gray-100 section-hidden">
        <div class="container mx-auto px-6">
            <h2 class="text-4xl font-extrabold text-center mb-12 gradient-text-blue">Our Investment Plans</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-10">

                <!-- Standard Plan Card -->
                <div class="plan-card standard-plan bg-white rounded-3xl shadow-xl transform transition duration-300 hover:scale-105 flex flex-col cursor-pointer card-hover-effect"
                    data-plan-name="Standard Plan"
                    data-monthly-return="5%"
                    data-min-investment="500"
                    data-payout-frequency="One-Time (after lock-in)"
                    data-lock-in="2 months minimum"
                    data-benefits='["Stable 5% return on investment every month.", "Payout of principal and accumulated returns will be made one time after the 2-month lock-in period.", "Referral Bonus: Refer any investor and earn 1% of their investment."]'
                    data-total-return="10% over 2 months"
                    data-referral-bonus-standard="1%"
                    data-referral-bonus-premium="1%"
                    data-referral-bonus-elite="1%">
                    <span class="plan-tag">NEW</span>
                    <div class="plan-icon-wrapper mx-auto mb-4">
                        <span class="plan-icon text-blue-600">🛡️</span>
                    </div>
                    <h3 class="text-3xl font-bold text-blue-700 mb-3 text-center">Standard Plan</h3>
                    <p class="text-lg mb-3 text-center">
                        <span class="block text-2xl font-semibold text-green-600 mb-1">5% Monthly Return</span>
                        Minimum Investment: <span class="font-bold">₹500</span><br>
                        Payout Frequency: One-Time (after lock-in)<br>
                        Lock-in Period: 2 months minimum
                    </p>
                    <div class="border-t border-gray-200 pt-3 mt-auto">
                        <h4 class="text-xl font-semibold text-gray-700 mb-2">Benefits:</h4>
                        <ul class="list-disc list-inside text-gray-600 space-y-1">
                            <li>Stable 5% return on investment every month.</li>
                            <li>Payout of principal and accumulated returns will be made one time after the 2-month lock-in period.</li>
                            <li>Referral Bonus: Refer any investor and earn 1% of their investment.</li>
                        </ul>
                    </div>
                </div>

                <!-- Premium 6-Month Plan Card -->
                <div class="plan-card premium-plan bg-white rounded-3xl shadow-xl transform transition duration-300 hover:scale-105 flex flex-col cursor-pointer card-hover-effect"
                    data-plan-name="Premium 6-Month Plan"
                    data-monthly-return="6%"
                    data-min-investment="500"
                    data-payout-frequency="Monthly"
                    data-lock-in="6 months"
                    data-benefits='["Bonus: Receive an additional 4% return at the end of the 6-month period.", "Total Return: 40% over 6 months (36% from monthly returns + 4% bonus).", "Perk: Priority Support.", "Referral Bonus: Refer another investor and earn a tiered bonus based on their plan."]'
                    data-total-return="40% over 6 months"
                    data-referral-bonus-standard="1%"
                    data-referral-bonus-premium="2%"
                    data-referral-bonus-elite="5%">
                     <div class="plan-icon-wrapper mx-auto mb-4">
                        <span class="plan-icon text-purple-600">⭐</span>
                    </div>
                    <h3 class="text-3xl font-bold text-purple-700 mb-3 text-center">Premium 6-Month Plan</h3>
                    <p class="text-lg mb-3 text-center">
                        <span class="block text-2xl font-semibold text-green-600 mb-1">6% Monthly Return</span>
                        Minimum Investment: <span class="font-bold">₹500</span><br>
                        Payout Frequency: Monthly<br>
                        Lock-in Period: 6 months
                    </p>
                    <div class="border-t border-gray-200 pt-3 mt-auto">
                        <h4 class="text-xl font-semibold text-gray-700 mb-2">SPECIAL OFFER:</h4>
                        <ul class="list-disc list-inside text-gray-600 space-y-1">
                            <li>Bonus: Receive an additional <span class="font-bold">4% return</span> at the end of the 6-month period.</li>
                            <li>Total Return: <span class="font-bold">40% over 6 months</span> (36% from monthly returns + 4% bonus).</li>
                        </ul>
                        <h4 class="text-xl font-semibold text-gray-700 mb-2 mt-4">Exclusive Perks:</h4>
                        <ul class="list-disc list-inside text-gray-600 space-y-1">
                            <li>Referral Bonus: Refer another investor and earn a tiered bonus based on their plan:
                                <ul class="list-circle list-inside ml-4">
                                    <li>Standard Plan: 1%</li>
                                    <li>6-Month Plan: 2%</li>
                                    <li>12-Month Plan: 5%</li>
                                </ul>
                            </li>
                        </ul>
                    </div>
                </div>

                <!-- Elite 12-Month Plan Card -->
                <div class="plan-card elite-plan bg-white rounded-3xl shadow-xl transform transition duration-300 hover:scale-105 flex flex-col cursor-pointer card-hover-effect"
                    data-plan-name="Elite 12-Month Plan"
                    data-monthly-return="7%"
                    data-min-investment="1000"
                    data-payout-frequency="Monthly"
                    data-lock-in="12 months"
                    data-benefits='["Bonus: Receive an additional 6% return at the end of the 12-month period.", "Total Return: 90% over 12 months (84% from monthly returns + 6% bonus).", "Referral Bonus: Refer another investor and earn a tiered bonus based on their plan.", "Annual Investment Report: Get a comprehensive analysis of your returns and market trends."]'
                    data-total-return="90% over 12 months"
                    data-referral-bonus-standard="1%"
                    data-referral-bonus-premium="3%"
                    data-referral-bonus-elite="7%">
                    <div class="plan-icon-wrapper mx-auto mb-4">
                        <span class="plan-icon text-yellow-600">👑</span>
                    </div>
                    <h3 class="text-3xl font-bold text-yellow-700 mb-3 text-center">Elite 12-Month Plan</h3>
                    <p class="text-lg mb-3 text-center">
                        <span class="block text-2xl font-semibold text-green-600 mb-1">7% Monthly Return</span>
                        Minimum Investment: <span class="font-bold">₹1000</span><br>
                        Payout Frequency: Monthly<br>
                        Lock-in Period: 12 months
                    </p>
                    <div class="border-t border-gray-200 pt-3 mt-auto">
                        <h4 class="text-xl font-semibold text-gray-700 mb-2">SPECIAL OFFER:</h4>
                        <ul class="list-disc list-inside text-gray-600 space-y-1">
                            <li>Bonus: Receive an additional <span class="font-bold">6% return</span> at the end of the 12-month period.</li>
                            <li>Total Return: <span class="font-bold">90% over 12 months</span> (84% from monthly returns + 6% bonus).</li>
                        </ul>
                        <h4 class="text-xl font-semibold text-gray-700 mb-2 mt-4">Exclusive Perks:</h4>
                        <ul class="list-disc list-inside text-gray-600 space-y-1">
                            <li>Referral Bonus: Refer another investor and earn a tiered bonus based on their plan:
                                <ul class="list-circle list-inside ml-4">
                                    <li>Standard Plan: 1%</li>
                                    <li>6-Month Plan: 3%</li>
                                    <li>12-Month Plan: 7%</li>
                                </ul>
                            </li>
                            <li>Annual Investment Report: Get a comprehensive analysis of your returns and market trends.</li>
                        </ul>
                    </div>
                </div>

            </div>
        </div>
    </section>

    <!-- How It Works Section -->
    <section id="how-it-works" class="py-20 bg-blue-700 text-white section-hidden">
        <div class="container mx-auto px-6 text-center">
            <h2 class="text-4xl font-extrabold mb-12">How It Works</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-10">
                <div class="bg-blue-600 rounded-2xl p-8 shadow-lg transform transition duration-300 hover:scale-105 hover:bg-blue-500">
                    <div class="text-5xl mb-4 float-animation">💰</div>
                    <h3 class="text-2xl font-bold mb-3">Consistent Monthly Payments</h3>
                    <p class="text-lg">Investors receive <span class="font-bold">competitive returns as per their chosen plan</span> on their principal investment every month, <span class="font-bold text-yellow-200">disbursed at the end of each calendar month,</span> reliably and on time.</p>
                </div>
                <div class="bg-blue-600 rounded-2xl p-8 shadow-lg transform transition duration-300 hover:scale-105 hover:bg-blue-500">
                    <div class="text-5xl mb-4 float-animation">🎁</div>
                    <h3 class="text-2xl font-bold mb-3">Bonus Offers</h3>
                    <p class="text-lg">Investors opting for <span class="font-bold">6-month or 12-month plans</span> are rewarded with an additional percentage at the end of their term as a loyalty bonus.</p>
                </div>
                <div class="bg-blue-600 rounded-2xl p-8 shadow-lg transform transition duration-300 hover:scale-105 hover:bg-blue-500">
                    <div class="text-5xl mb-4 float-animation">💸</div>
                    <h3 class="text-2xl font-bold mb-3">Flexible Withdrawals</h3>
                    <p class="text-lg">After the lock-in period, investors may choose to <span class="font-bold">withdraw their principal investment and any accumulated bonuses,</span> reinvest, or continue receiving monthly returns. <span class="font-bold text-yellow-200">For early withdrawals (before lock-in ends), the principal amount will be returned after 15 days, with a deduction equivalent to 2 months' returns.</span></p>
                </div>
            </div>
        </div>
    </section>

    <!-- Why Choose Us Section -->
    <section id="why-choose-us" class="py-20 bg-gray-50 section-hidden">
        <div class="container mx-auto px-6">
            <h2 class="text-4xl font-extrabold text-center mb-12 gradient-text-blue">Why Choose ADS FUND?</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-10">
                <!-- High Returns Button -->
                <button class="why-choose-us-button high-returns"
                        data-title="High Returns"
                        data-content="We prioritize helping your money grow faster than traditional saving methods. Our investment plans offer industry-leading monthly returns that consistently outperform banks and fixed deposits.<ul><li>Monthly Payouts: Get regular income each month, not just at the end of your investment term.</li><li>Compounding Advantage: Reinvesting your returns amplifies your wealth over time.</li><li>Flexible Options: Choose from multiple plans (Standard, Premium, Elite) based on your goals and comfort level.</li><li>Example: ₹10,000 in the Elite plan (7% monthly) grows to ₹19,000 in just one year.</li></ul>✅ Why this matters: You're not waiting years to see results — your money works now and keeps growing with you.">
                    <div class="icon-wrapper text-green-600 float-animation">📈</div>
                    <h3>High Returns</h3>
                    <p class="text-lg text-gray-700">We offer industry-leading returns with guaranteed monthly payouts, maximizing your investment growth.</p>
                </button>

                <!-- Special Offers Button -->
                <button class="why-choose-us-button special-offers"
                        data-title="Special Offers"
                        data-content="Maximize your profits with our exclusive 6-month and 12-month bonuses, rewarding your loyalty. These special offers are designed to give you even greater returns for longer-term commitments, enhancing your overall investment experience with additional benefits.<ul><li>6-Month Bonus: Premium investors get a 4% additional bonus on top of their monthly interest.</li><li>12-Month Bonus: Elite plan investors enjoy a 6% bonus, significantly boosting total returns.</li><li>Referral Rewards: Invite others and earn up to 7% referral bonuses, compounding your benefits.</li><li>Flexibility: Reinvest bonuses or withdraw them after lock-in — it’s your choice.</li></ul>🎁 Why this matters: Long-term investors get extra profit, and your trust earns tangible rewards.">
                    <div class="icon-wrapper text-orange-600 float-animation">⭐</div>
                    <h3>Special Offers</h3>
                    <p class="text-lg text-gray-700">Maximize your profits with our exclusive 6-month and 12-month bonuses, rewarding your loyalty.</p>
                </button>

                <!-- Security & Trust Button -->
                <button class="why-choose-us-button security-trust"
                        data-title="Security & Trust"
                        data-content="Your investment is protected with transparent terms and a dedicated support team, ensuring peace of mind. We prioritize the security of your funds and personal data, employing robust measures and maintaining clear communication to build and uphold your trust.<ul><li>Transparent Terms: No hidden clauses. Every detail about returns, lock-in periods, and withdrawals is clearly stated upfront.</li><li>Dedicated Support: Our investor support team is available to guide you at every step.</li><li>Trusted Platform: Built on Google Firebase — ensuring your data is secure, your identity is protected, and your records are safe.</li><li>Bank-Verified Details: We verify each transaction via UTR number and match bank details before processing.</li></ul>🛡️ Why this matters: You can invest confidently, knowing your funds are handled with care, clarity, and integrity.">
                    <div class="icon-wrapper text-teal-600 float-animation">🔒</div>
                    <h3>Security & Trust</h3>
                    <p class="text-lg text-gray-700">Your investment is protected with transparent terms and a dedicated support team, ensuring peace of mind.</p>
                </button>
            </div>
            <p class="text-center text-xl text-gray-700 mt-12 max-w-3xl mx-auto">
                This structure encourages longer-term investments by offering additional bonuses, while also giving flexibility to those interested in shorter-term gains.
            </p>
        </div>
    </section>

    <!-- Limited Time Offer Section -->
    <section id="limited-time-offer" class="py-20 bg-gradient-to-r from-red-600 to-red-800 text-white text-center animate-pulse-light section-hidden">
        <div class="container mx-auto px-6">
            <h2 class="text-5xl font-extrabold mb-6">🔥 Limited Time Offer! 🔥</h2>
            <p class="text-2xl mb-8 max-w-2xl mx-auto offer-text-glow">
                Invest in our Premium 6-Month Plan within <span class="font-bold" id="offerTimePeriod">the time period</span> and receive an <span class="bonus-highlight">additional 5% bonus</span> at the end of your term!
            </p>
            <div class="countdown-timer mb-8" id="countdown"></div>
            <a href="#plans" class="bg-yellow-400 hover:bg-yellow-500 text-red-900 font-bold py-3 px-10 rounded-full shadow-lg transform transition duration-300 hover:scale-105 inline-block text-xl">
                Seize This Opportunity!
            </a>
        </div>
    </section>

    <!-- Investment Calculator Section -->
    <section id="ai-calculator" class="py-20 bg-gradient-to-br from-blue-700 to-indigo-800 text-white section-hidden">
        <div class="container mx-auto px-6 text-center">
            <h2 class="text-4xl font-extrabold mb-12">Calculate Your Returns</h2>
            <div class="bg-blue-600 rounded-2xl p-8 shadow-xl max-w-xl mx-auto">
                <div class="mb-6 text-left">
                    <label for="investmentAmount" class="block text-xl font-medium mb-2">Investment Amount (₹):</label>
                    <input type="number" id="investmentAmount" value="1000" min="0" step="100" class="w-full p-3 rounded-lg bg-blue-700 border border-blue-500 text-white placeholder-blue-300 focus:ring-2 focus:ring-yellow-400 focus:border-transparent transition duration-200" placeholder="e.g., 500, 1000">
                </div>
                <div class="mb-8 text-left">
                    <label for="investmentPlan" class="block text-xl font-medium mb-2">Select Investment Plan:</label>
                    <select id="investmentPlan" class="w-full p-3 rounded-lg bg-blue-700 border border-blue-500 text-white focus:ring-2 focus:ring-yellow-400 focus:border-transparent transition duration-200">
                        <option value="standard">Standard Plan (2+ months)</option>
                        <option value="premium">Premium 6-Month Plan</option>
                        <option value="elite">Elite 12-Month Plan</option>
                    </select>
                </div>
                <button id="calculateBtn" class="bg-yellow-400 hover:bg-yellow-500 text-blue-900 font-bold py-3 px-8 rounded-full shadow-lg transform transition duration-300 hover:scale-105 inline-flex items-center justify-center">
                    Calculate Returns
                </button>

                <div id="results" class="mt-10 text-left bg-blue-700 p-6 rounded-lg hidden">
                    <h3 class="text-2xl font-bold mb-4 text-yellow-300">Projected Returns:</h3>
                    <p class="text-xl mb-4">Initial Investment: <span id="displayInitialInvestment" class="font-semibold">₹0</span></p>
                    <p class="text-xl mb-4">Projected Total Return: <span id="displayTotalReturn" class="font-semibold">₹0</span></p>
                    <p class="text-xl mb-4">Total Percentage Return: <span id="displayPercentageReturn" class="font-semibold">0%</span></p>
                </div>
                <div id="errorMessage" class="mt-6 text-red-300 text-lg hidden">
                    An error occurred. Please try again later.
                </div>
            </div>
        </div>
    </section>

    <!-- Removed: Bank Details Section from here -->

    <!-- Footer Section -->
    <footer class="bg-gray-800 text-white py-8">
        <div class="container mx-auto px-6 text-center text-gray-400">
            <p>&copy; 2024 ADS FUND. All rights reserved.</p>
            <p class="mt-2">For inquiries, please contact us at <a href="mailto:itsads2k23@gmail.com" class="text-blue-400 hover:underline">itsads2k23@gmail.com</a></p>
        </div>
    </footer>

    <!-- Investment Plan Detail Modal -->
    <div id="planDetailModal" class="modal-overlay">
        <div class="modal-content text-gray-800">
            <button class="modal-close-btn" id="closePlanDetailModalBtn">&times;</button>
            <h3 id="modalPlanName" class="text-3xl font-bold text-blue-700 mb-4"></h3>
            <p class="text-lg mb-2"><strong>Monthly Return:</strong> <span id="modalMonthlyReturn"></span></p>
            <p class="text-lg mb-2"><strong>Minimum Investment:</strong> ₹<span id="modalMinInvestment"></span></p>
            <p class="text-lg mb-2"><strong>Payout Frequency:</strong> <span id="modalPayoutFrequency"></span></p>
            <p class="text-lg mb-4"><strong>Lock-in Period:</strong> <span id="modalLockIn"></span></p>
            <p class="text-lg mb-4"><strong>Total Projected Return:</strong> <span id="modalTotalReturn"></span></p>
            <h4 class="text-xl font-semibold text-gray-700 mb-2">Key Highlights:</h4>
            <ul id="modalBenefits" class="list-disc list-inside text-gray-600 space-y-1 mb-6">
                <!-- Benefits will be populated here -->
            </ul>
            <div id="modalReferralInfo" class="mt-4 p-3 bg-blue-50 rounded-lg border border-blue-200 hidden">
                <h4 class="text-xl font-semibold text-blue-700 mb-2">Referral Bonus for this Plan:</h4>
                <p id="modalReferralText" class="text-lg text-gray-700"></p>
            </div>

            <button id="investNowBtn" class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-6 rounded-full shadow-md transform transition duration-300 hover:scale-105">
                Invest Now!
            </button>
        </div>
    </div>

    <!-- Investment Form Modal (repurposed from #investForm) -->
    <div id="investModal" class="modal-overlay">
        <div class="modal-content text-gray-800">
            <button class="modal-close-btn" id="closeInvestModalBtn">&times;</button>
            <h2 class="text-3xl font-bold text-blue-700 mb-6 text-center">Invest in <span id="investFormPlanName"></span></h2>
            <form id="investmentForm" class="flex flex-col items-center">
                <label for="inv_name" class="w-full">Your Name:</label>
                <input type="text" id="inv_name" placeholder="Your Name" required class="w-full">

                <label for="inv_email" class="w-full">Your Email:</label>
                <input type="email" id="inv_email" placeholder="Your Email" required class="w-full">

                <label for="inv_mobile" class="w-full">Mobile Number:</label>
                <input type="tel" id="inv_mobile" placeholder="Mobile Number" required class="w-full">

                <label for="inv_amount" class="w-full">Investment Amount (₹):</label>
                <input type="number" id="inv_amount" placeholder="Investment Amount (₹)" min="500" step="100" required class="w-full">
                <p class="text-sm text-gray-700 text-left w-full mt-1" id="invAmountValidationMessage">Minimum ₹500, in multiples of ₹100. Maximum ₹10,000.</p>

                <!-- NEW: UPI Payment Options Section -->
                <div class="upi-payment-options w-full">
                    <p class="text-lg font-semibold text-gray-800 mb-2">Choose your payment method:</p>
                    <div class="flex flex-col md:flex-row gap-4 w-full justify-center">
                        <button type="button" class="upi-app-button gpay" data-upi-app="gpay">
                            <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/f/f2/Google_Pay_Logo.svg/1200px-Google_Pay_Logo.svg.png" alt="GPay Logo"> Pay with GPay
                        </button>
                        <button type="button" class="upi-app-button phonepe" data-upi-app="phonepe">
                            <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/c/c5/PhonePe_Logo.svg/1200px-PhonePe_Logo.svg.png" alt="PhonePe Logo"> Pay with PhonePe
                        </button>
                        <button type="button" class="upi-app-button paytm" data-upi-app="paytm">
                            <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/2/24/Paytm_Logo.png/1200px-Paytm_Logo.png" alt="Paytm Logo"> Pay with Paytm
                        </button>
                    </div>

                    <div class="qr-code-container w-full mt-4">
                        <p class="font-semibold text-gray-700 mb-2">Scan to Pay:</p>
                        <img id="upiQrCode" src="" alt="UPI QR Code">
                        <p>Or manually copy one of our UPI IDs:</p>
                        <div class="manual-upi-display">
                            <span class="upi-id-text" id="displayUpiId1">chowdhurybarnadip98-1@okicici</span>
                            <button type="button" class="copy-btn-small" data-copy-target="displayUpiId1">Copy</button>
                        </div>
                        <div class="manual-upi-display mt-2">
                            <span class="upi-id-text" id="displayUpiId2">mr.4989@superyes</span>
                            <button type="button" class="copy-btn-small" data-copy-target="displayUpiId2">Copy</button>
                        </div>
                    </div>
                </div>

                <label for="inv_utr_number" class="w-full">UTR Number (Mandatory, after payment):</label>
                <input type="text" id="inv_utr_number" placeholder="Enter UTR/Transaction Number" required class="w-full">

                <label for="paidUpiId" class="w-full">Which UPI ID did you pay to?</label>
                <select id="paidUpiId" required class="w-full">
                    <option value="">Select UPI ID</option>
                    <option value="chowdhurybarnadip98-1@okicici">chowdhurybarnadip98-1@okicici</option>
                    <option value="mr.4989@superyes">mr.4989@superyes</option>
                </select>
                
                <input type="hidden" id="inv_plan_hidden"> <!-- Hidden field to store selected plan name -->

                <!-- Terms & Conditions Checkbox -->
                <div class="terms-checkbox-group w-full justify-start">
                    <input type="checkbox" id="acceptTerms" class="form-checkbox h-5 w-5 text-blue-600 rounded">
                    <label for="acceptTerms" class="text-base text-gray-700">
                        I accept the <a href="#" id="viewTermsLink" class="terms-link">Terms & Conditions</a>
                    </label>
                </div>


                <div class="flex justify-center space-x-4 mt-6 w-full">
                    <button type="submit" class="w-1/2" id="submitInvestmentBtn">Submit Investment</button>
                    <button type="button" class="w-1/2 cancel-btn" id="cancelInvestFormBtn">Cancel</button>
                </div>
            </form>
        </div>
    </div>


    <!-- Sign In Modal -->
    <div id="signInModal" class="modal-overlay">
        <div class="modal-content text-gray-800">
            <button class="modal-close-btn" id="closeSignInModalBtn">&times;</button>
            <h2 class="text-3xl font-bold text-blue-700 mb-6 text-center">Sign In</h2>
            <form id="signInForm" class="flex flex-col items-center">
                <label for="signInEmail" class="w-full">Email:</label>
                <input type="email" id="signInEmail" placeholder="Your Email" required class="w-full">

                <label for="signInPassword" class="w-full">Password:</label>
                <input type="password" id="signInPassword" placeholder="Your Password" required class="w-full">

                <div class="flex justify-center space-x-4 mt-6 w-full">
                    <button type="submit" class="w-1/2" id="signInSubmitBtn">Sign In</button>
                    <button type="button" class="w-1/2 cancel-btn" id="cancelSignInBtn">Cancel</button>
                </div>
                <p class="text-center text-sm text-gray-600 mt-4">
                    Don't have an account? <a href="#" id="switchToSignUp" class="text-blue-500 hover:underline">Sign Up</a>
                </p>
            </form>
        </div>
    </div>

    <!-- Sign Up Modal -->
    <div id="signUpModal" class="modal-overlay">
        <div class="modal-content text-gray-800">
            <button class="modal-close-btn" id="closeSignUpModalBtn">&times;</button>
            <h2 class="text-3xl font-bold text-blue-700 mb-6 text-center">Sign Up</h2>
            <form id="signUpForm" class="flex flex-col items-center">
                <label for="signUpEmail" class="w-full">Email:</label>
                <input type="email" id="signUpEmail" placeholder="Your Email" required class="w-full">

                <label for="signUpPassword" class="w-full">Password:</label>
                <input type="password" id="signUpPassword" placeholder="Create Password" required class="w-full">
                <p class="text-sm text-gray-700 text-left w-full mt-1">Minimum 6 characters.</p>

                <label for="signUpConfirmPassword" class="w-full">Confirm Password:</label>
                <input type="password" id="signUpConfirmPassword" placeholder="Confirm Password" required class="w-full">
                
                <!-- Retained: Referral ID input in Sign Up form (for tracking who referred this new user) -->
                <label for="signUpReferrerId" class="w-full">Referrer ID (Optional):</label>
                <input type="text" id="signUpReferrerId" placeholder="Referrer's 6-digit ID (e.g., 123456)" pattern="\d{6}" title="Referrer ID must be a 6-digit number" class="w-full">

                <div class="flex justify-center space-x-4 mt-6 w-full">
                    <button type="submit" class="w-1/2" id="signUpSubmitBtn">Sign Up</button>
                    <button type="button" class="w-1/2 cancel-btn" id="cancelSignUpBtn">Cancel</button>
                </div>
                <p class="text-center text-sm text-gray-600 mt-4">
                    Already have an account? <a href="#" id="switchToSignIn" class="text-blue-500 hover:underline">Sign In</a>
                </p>
            </form>
        </div>
    </div>

    <!-- Custom Message Modal -->
    <div id="messageModal" class="modal-overlay">
        <div class="modal-content text-gray-800 bg-white rounded-3xl p-8 shadow-xl text-center">
            <h3 id="messageModalTitle" class="text-2xl font-bold mb-4"></h3>
            <p id="messageModalText" class="text-lg mb-6"></p>
            <button id="closeMessageModalBtn" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-6 rounded-full shadow-md">
                OK
            </button>
        </div>
    </div>

    <!-- My Investments Modal (New) -->
    <div id="myInvestmentsModal" class="modal-overlay">
        <div class="modal-content text-gray-800">
            <button class="modal-close-btn" id="closeMyInvestmentsModalBtn">&times;</button>
            <h2 class="text-3xl font-bold text-blue-700 mb-6 text-center">My Investments</h2>
            <div id="investments-container" class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <!-- Investment summary cards will be dynamically loaded here -->
                <p id="no-investments-message" class="text-center text-lg text-gray-600 col-span-full">
                    You have no investments yet. Start investing today!
                </p>
            </div>
            <p id="current-user-id" class="text-center text-sm text-gray-500 mt-8"></p>
        </div>
    </div>

    <!-- Investment Details Modal (New) -->
    <div id="investmentDetailsModal" class="modal-overlay">
        <div class="modal-content text-gray-800">
            <button class="modal-close-btn" id="closeInvestmentDetailsModalBtn">&times;</button>
            <h2 id="detailModalPlanName" class="text-3xl font-bold text-blue-700 mb-6 text-center"></h2>
            <div class="investment-details-group space-y-1 mb-6">
                <p>
                    <span class="flex items-center"><span class="mr-2 text-blue-600">💰</span>Invested Amount:</span> <strong id="detailInvestedAmount" class="text-blue-700"></strong>
                </p>
                <p>
                    <span class="flex items-center"><span class="mr-2 text-green-600">📈</span>Monthly Payout:</span> <strong id="detailMonthlyPayout" class="text-green-700"></strong>
                </p>
                <p>
                    <span class="flex items-center"><span class="mr-2 text-green-600">💸</span>Projected Total Return:</span> <strong id="detailProjectedTotalReturn" class="text-green-700"></strong>
                </p>
                <p>
                    <span class="flex items-center"><span class="mr-2 text-red-500">🗓️</span>Invest Date:</span> <strong id="detailInvestDate" class="text-gray-800"></strong>
                </p>
                <p>
                    <span class="flex items-center"><span class="mr-2 text-red-500">🗓️</span>Your Plan End date:</span> <strong id="detailPlanEndDate" class="text-gray-800"></strong>
                </p>
                <p>
                    <span class="flex items-center"><span class="mr-2 text-red-500">🗓️</span>You will get your investment back:</span> <strong id="detailPayoutReturnDate" class="text-gray-800"></strong>
                </p>
            </div>
            <!-- Removed the financial-details-group as requested -->
        </div>
    </div>

    <!-- New: Refer & Earn Modal (Simplified) -->
    <div id="referEarnModal" class="modal-overlay">
        <div class="modal-content text-gray-800">
            <button class="modal-close-btn" id="closeReferEarnModalBtn">&times;</button>
            <h2 class="text-3xl font-bold text-blue-700 mb-6 text-center">Refer & Earn</h2>
            
            <p class="text-center text-base font-semibold text-green-700 mb-6">
                Your referral earnings will be credited directly to your bank account within 24 hours of your referred investor's successful investment.
            </p>

            <div class="bg-green-50 p-6 rounded-lg mb-6 text-center shadow-inner">
                <p class="text-lg font-semibold text-green-800 mb-3">Your Unique Referrer ID:</p>
                <div class="flex items-center justify-center space-x-2 mb-4">
                    <span id="yourReferralId" class="font-mono text-xl md:text-2xl font-bold text-green-700 break-all">Loading...</span>
                    <button type="button" class="copy-upi-btn bg-green-600 hover:bg-green-700" data-copy-target="yourReferralId">Copy</button>
                </div>
                <!-- New: Referral Link Section -->
                <p class="text-lg font-semibold text-green-800 mb-3">Share this Referral Link:</p>
                <div class="flex items-center justify-center space-x-2 mb-4">
                    <span id="yourReferralLink" class="font-mono text-base md:text-lg text-blue-700 break-all">Loading...</span>
                    <button type="button" class="copy-upi-btn bg-blue-600 hover:bg-blue-700" data-copy-target="yourReferralLink">Copy</button>
                </div>
                <!-- New: Total Referral Earnings Display -->
                <p class="text-lg font-semibold text-green-800 mb-3">Total Referral Earnings:</p>
                <p id="totalReferralEarnings" class="font-mono text-xl md:text-2xl font-bold text-green-700">₹0.00</p>
            </div>

            <!-- NEW: Dynamic Referral Offers based on membership -->
            <div id="referralOfferDetails" class="bg-blue-50 p-6 rounded-lg mb-6 text-center shadow-inner">
                <!-- Content will be dynamically loaded here by JavaScript -->
            </div>

            <h3 class="text-2xl font-bold text-blue-700 mb-4 text-center">Users You've Referred</h3>
            <p id="noReferredUsersMessage" class="text-center text-lg text-gray-600 mb-4">No users referred yet. Share your ID!</p>
            <div id="referredUsersList" class="space-y-4">
                <!-- Referred users (ID and joined date) will be loaded here -->
            </div>
        </div>
    </div >


    <!-- Terms and Conditions Modal -->
    <div id="termsAndConditionsModal" class="modal-overlay">
        <div class="modal-content text-gray-800">
            <button class="modal-close-btn" id="closeTermsAndConditionsModalBtn">&times;</button>
            <h2 class="text-3xl font-bold text-blue-700 mb-6 text-center">Terms & Conditions</h2>
            <div class="text-sm text-gray-700 space-y-4 max-h-96 overflow-y-auto pr-2">
                <p>Welcome to ADS FUND. By proceeding with any investment through our platform, you acknowledge that you have read, understood, and agree to be bound by the following Terms & Conditions. Please read them carefully.</p>

                <h3 class="text-xl font-semibold text-gray-800 mt-6 mb-2">1. Acceptance of Terms</h3>
                <p>By clicking "I accept the Terms & Conditions" and submitting your investment, you enter into a binding agreement with ADS FUND. If you do not agree to these terms, you should not proceed with any investment.</p>

                <h3 class="text-xl font-semibold text-gray-800 mt-6 mb-2">2. Investment Risks</h3>
                <p>Investment in financial products involves inherent risks. While ADS FUND strives to provide consistent returns as outlined in our plans, we cannot guarantee any specific rate of return or the preservation of your principal investment. Market conditions, economic factors, and other unforeseen circumstances can impact investment performance. You acknowledge that you understand these risks and are willing to bear them.</p>

                <h3 class="text-xl font-semibold text-gray-800 mt-6 mb-2">3. No Financial Advice</h3>
                <p>The information provided on this website and through our communications is for general informational purposes only and does not constitute financial, investment, legal, or tax advice. You are solely responsible for conducting your own due diligence and consulting with qualified professionals before making any investment decisions.</p>

                <h3 class="text-xl font-semibold text-gray-800 mt-6 mb-2">4. Investment Plans and Returns</h3>
                <p>Details of our investment plans, including monthly returns, minimum investment amounts, payout frequencies, and lock-in periods, are as specified on the "Investment Plans" section of this website. Projected returns and bonuses are based on current market analysis and historical performance, but are not guaranteed.</p>
                <ul class="list-disc list-inside ml-4">
                    <li><strong>Monthly Payouts:</strong> Monthly returns (e.g., 7.5%) are calculated on your principal investment and are typically disbursed at the end of each calendar month.</li>
                    <li><strong>Bonuses:</strong> Additional bonuses for 6-month or 12-month plans are conditional upon the completion of the respective lock-in periods.</li>
                </ul>

                <h3 class="text-xl font-semibold text-gray-800 mt-6 mb-2">5. Lock-in Periods and Withdrawals</h3>
                <p>Each investment plan has a specified lock-in period. During this period, your principal investment is committed to the fund.</p>
                <ul class="list-disc list-inside ml-4">
                    <li><strong>After Lock-in:</strong> Upon completion of the lock-in period, you may choose to withdraw your principal and any accumulated bonuses, reinvest, or continue receiving monthly returns.</li>
                    <li><strong>Early Withdrawals:</strong> For withdrawals requested before the completion of the stated lock-in period, the principal amount will be returned after a processing period of 15 business days. An early withdrawal penalty equivalent to <strong>two months' projected returns</strong> on the principal amount will be deducted from your principal before disbursement.</p>
                </ul>

                <h3 class="text-xl font-semibold text-gray-800 mt-6 mb-2">6. KYC and Verification</h3>
                <p>To comply with regulatory requirements and prevent fraud, ADS FUND reserves the right to request Know Your Customer (KYC) documentation and other verification details from investors at any time. Failure to provide requested information may result in delays in processing investments or withdrawals, or the suspension of your account.</p>

                <h3 class="text-xl font-semibold text-gray-800 mt-6 mb-2">7. Payment and UTR Number</h3>
                <p>All investments must be made through the specified UPI IDs or bank transfer methods provided on our investment form. It is mandatory to provide an accurate UTR (Unique Transaction Reference) or transaction number for all payments. Investments cannot be confirmed or processed without a valid UTR number.</p>

                <h3 class="text-xl font-semibold text-gray-800 mt-6 mb-2">8. Limitation of Liability</h3>
                <p>ADS FUND, its directors, employees, or affiliates shall not be liable for any direct, indirect, incidental, special, consequential, or punitive damages, including but not limited to, loss of profits, data, or other intangible losses, resulting from:</p>
                <ul class="list-disc list-inside ml-4">
                    <li>Your access to or use of, or inability to access or use, the service;</li>
                    <li>Any conduct or content of any third party on the service;</li>
                    <li>Any content obtained from the service; and</li>
                    <li>Unauthorized access, use, or alteration of your transmissions or content, whether based on warranty, contract, tort (including negligence), or any other legal theory, whether or not we have been informed of the possibility of such damage.</li>
                </ul>

                <h3 class="text-xl font-semibold text-gray-800 mt-6 mb-2">9. Privacy Policy</h3>
                <p>Your privacy is important to us. Our <a href="#" class="terms-link">Privacy Policy</a>, available on our website, explains how we collect, use, and protect your personal information. By agreeing to these Terms & Conditions, you also agree to our Privacy Policy.</p>

                <h3 class="text-xl font-semibold text-gray-800 mt-6 mb-2">10. Governing Law and Dispute Resolution</h3>
                <p>These Terms & Conditions shall be governed by and construed in accordance with the laws of India. Any disputes arising out of or in connection with these terms shall be subject to the exclusive jurisdiction of the courts in [Specify City/State, e.g., Mumbai, Maharashtra], India.</p>

                <h3 class="text-xl font-semibold text-gray-800 mt-6 mb-2">11. Amendments to Terms</h3>
                <p>ADS FUND reserves the right to amend or update these Terms & Conditions at any time without prior notice. It is your responsibility to review these terms periodically for any changes. Your continued use of the service or continued investment after any amendments constitutes your acceptance of the revised terms.</p>

                <h3 class="text-xl font-semibold text-gray-800 mt-6 mb-2">12. Contact Information</h3>
                <p>For any questions regarding these Terms & Conditions, please contact us at <a href="mailto:itsads2k23@gmail.com" class="terms-link">itsads2k23@gmail.com</a>.</p>
            </div>
            <button id="closeTermsContentBtn" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-6 rounded-full shadow-md mt-8">
                OK
            </button>
        </div>
    </div >

    <!-- New: Where Your Money Works Modal (Re-designed) -->
    <div id="whereMoneyWorksModal" class="modal-overlay">
        <div class="modal-content text-gray-800">
            <button class="modal-close-btn" id="closeWhereMoneyWorksModalBtn">&times;</button>
            <h2 class="text-3xl font-bold text-blue-700 mb-6 text-center">Where Your Money Works: Building Your Future, Bit by Bit</h2>
            
            <p class="intro-text">
                At ADS FUND, we believe in a diversified and strategic approach to investment. Your capital is carefully allocated across two primary avenues to maximize returns while managing risk effectively. We prioritize transparency and security in every step.
            </p>

            <div class="grid grid-cols-1 gap-6">
                <div class="info-card market-card">
                    <div class="icon">📈</div>
                    <h3 class="text-2xl font-bold mb-3">Strategic Investments in Share Market</h3>
                    <p class="text-lg text-gray-700">A significant portion of your capital is expertly managed in the share market. Our approach includes:</p>
                    <ul>
                        <li><span class="font-bold">Diversified Portfolios:</span>Investing across various sectors and companies to mitigate risk.</li>
                        <li><span class="font-bold">Fundamental & Technical Analysis:</span> Employing in-depth research to identify high-growth potential stocks.</li>
                        <li><span class="font-bold">Dynamic Trading Strategies:</span> Adapting to market conditions with agile buying and selling to capitalize on opportunities.</li>
                        <li><span class="font-bold">Long-term Growth Focus:</span> Balancing short-term gains with sustainable long-term capital appreciation.</li>
                    </ul>
                    <p class="text-lg text-gray-700 mt-4">This strategy aims to generate substantial returns by leveraging market movements and expert insights.</p>
                </div>
                <div class="info-card lending-card">
                    <div class="icon">🤝</div>
                    <h3 class="text-2xl font-bold mb-3">Secure Lending on Trusted Platforms</h3>
                    <p class="text-lg text-gray-700">To ensure stable and consistent returns, a portion of your investment is allocated to lending on verified and trusted platforms. This includes:</p>
                    <ul>
                        <li><span class="font-bold">Peer-to-Peer (P2P) Lending:</span> Facilitating loans to creditworthy individuals or small businesses.</li>
                        <li><span class="font-bold">Secured Debt Instruments:</span> Investing in debt instruments backed by collateral for enhanced security.</li>
                        <li><span class="font-bold">Rigorous Due Diligence:</span> Partnering only with platforms that have stringent borrower vetting processes.</li>
                        <li><span class="font-bold">Consistent Income Stream:</span> Generating predictable interest income to provide a stable foundation for your returns.</li>
                    </ul>
                    <p class="text-lg text-gray-700 mt-4">This diversifies risk and provides a reliable income stream, ensuring your money is always working for you, even during market fluctuations.</p>
                </div>
            </div>
            <p class="conclusion-text">
                By strategically combining these two powerful investment avenues, ADS FUND strives to deliver optimal returns, secure your principal, and build a robust financial future for our investors. Your trust is our greatest asset.
            </p>
        </div>
    </div >

    <!-- New: Bank Card Modal -->
    <div id="bankCardModal" class="modal-overlay">
        <div class="modal-content text-gray-800">
            <button class="modal-close-btn" id="closeBankCardModalBtn">&times;</button>
            <h2 class="text-3xl font-bold text-blue-700 mb-6 text-center">Your Bank Details</h2>
            <p class="text-lg text-gray-700 mb-6 text-center" id="bankDetailsInstructionText">
                Please provide your bank details for seamless payouts of your returns and principal.
            </p>
            <form id="bankCardForm" class="flex flex-col items-center">
                <label for="bankAccountName" class="w-full">Bank Account Name:</label>
                <input type="text" id="bankAccountName" placeholder="Name on Bank Account" required class="w-full">

                <label for="bankAccountNumber" class="w-full">Bank Account Number:</label>
                <input type="text" id="bankAccountNumber" placeholder="Bank Account Number" required class="w-full">

                <label for="ifscCode" class="w-full">IFSC Code:</label>
                <input type="text" id="ifscCode" placeholder="IFSC Code" required class="w-full">

                <label for="upiIdOptional" class="w-full">Your UPI ID (Optional):</label>
                <input type="text" id="upiIdOptional" placeholder="Your UPI ID (Optional)" class="w-full">

                <div class="flex justify-center space-x-4 mt-6 w-full" id="bankDetailsFormButtons">
                    <button type="submit" class="w-1/2" id="saveBankDetailsBtn">Save Bank Details</button>
                    <button type="button" class="w-1/2 cancel-btn" id="cancelBankDetailsBtn">Cancel</button>
                </div>
                <p id="bankDetailsSavedMessage" class="text-center text-red-600 font-semibold mt-4 hidden">
                    Bank details saved. For any changes, please contact us at <a href="mailto:itsads2k23@gmail.com" class="text-blue-500 hover:underline">itsads2k23@gmail.com</a>.
                </p>
            </form>
        </div>
    </div>

    <!-- NEW: Payment History Modal -->
    <div id="paymentHistoryModal" class="modal-overlay">
        <div class="modal-content text-gray-800">
            <button class="modal-close-btn" id="closePaymentHistoryModalBtn">&times;</button>
            <h2 class="text-3xl font-bold text-blue-700 mb-6 text-center">Payment History</h2>
            <div id="payment-history-container" class="space-y-4">
                <!-- Payment items will be dynamically loaded here -->
                <p id="no-payment-history-message" class="text-center text-lg text-gray-600">
                    No payment history found.
                </p>
            </div>
        </div>
    </div>

    <!-- NEW: Why Choose Us Detail Modal -->
    <div id="whyChooseUsDetailModal" class="modal-overlay">
        <div class="modal-content text-gray-800">
            <button class="modal-close-btn" id="closeWhyChooseUsDetailModalBtn">&times;</button>
            <h2 id="whyChooseUsDetailModalTitle" class="text-3xl font-bold text-blue-700 mb-6 text-center"></h2>
            <div id="whyChooseUsDetailModalContent" class="text-lg mb-6 text-center"></div>
            <button id="closeWhyChooseUsDetailModalBtnBottom" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-6 rounded-full shadow-md">
                Got It!
            </button>
        </div>
    </div>


    <script type="module">
        // Global variable to store referral ID from URL
        let referralIdFromUrl = null;

        // Firebase imports
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js"; // Updated SDK version
        import {
            getAuth,
            signInAnonymously,
            signInWithCustomToken,
            onAuthStateChanged,
            createUserWithEmailAndPassword,
            signInWithEmailAndPassword,
            signOut
        } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-auth.js"; // Updated SDK version
        import {
            getFirestore,
            collection,
            addDoc,
            doc,
            setDoc,
            query,
            where,
            onSnapshot,
            serverTimestamp,
            getDoc,
            getDocs,
            updateDoc
            // Removed updateDoc and FieldValue as they are no longer used client-side for referral earnings
        } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore.js"; // Updated SDK version

        // Global Firebase variables - declared as `let` so they can be assigned later
        let app;
        let auth;
        let db; // Firestore instance
        let currentUserId = null; // To store the Firebase authenticated user's UID
        let currentUserCustomId = null; // To store the user's generated 6-digit ID
        let currentUserEmail = null; // To store the authenticated user's email
        let currentUserReferredBy = null; // Store the referrer's custom ID for the current user
        let currentUserReferralEarningsTotal = 0; // New: To store the total referral earnings
        let selectedPlanDetails = {}; // To store details of the plan chosen by the user
        let appId; // Declare appId globally for Firestore paths
        let userInvestmentsData = []; // Store fetched investments here
        let isAuthReady = false; // New flag to indicate Firebase Auth is initialized and state determined
        let userCurrentPlans = []; // To store the list of plans the current user has invested in
        let currentUserBankDetails = {}; // New: To store the current user's bank details
        let userPaymentHistoryData = []; // New: To store fetched payment history

        // Unsubscribe functions for onSnapshot listeners
        let unsubscribeInvestments = null;
        let unsubscribeCurrentUserDoc = null; // New unsubscribe for the current user's document
        let unsubscribePaymentHistory = null; // New unsubscribe for payment history


        // --- Custom Message Modal Functions ---
        const messageModal = document.getElementById('messageModal');
        const messageModalTitle = document.getElementById('messageModalTitle');
        const messageModalText = document.getElementById('messageModalText');
        const closeMessageModalBtn = document.getElementById('closeMessageModalBtn');

        function showMessage(title, text, isSuccess = true) {
            console.log(`[Message Modal] Title: ${title}, Text: ${text}, Success: ${isSuccess}`); // Debugging
            if (messageModalTitle) messageModalTitle.textContent = title;
            if (messageModalText) messageModalText.innerHTML = text; // Use innerHTML for text that might contain HTML tags
            if (messageModal) {
                if (isSuccess) {
                    messageModalTitle.style.color = '#065f46'; // green-800
                    messageModalText.style.color = '#065f46'; // green-800
                } else {
                    messageModalTitle.style.color = '#991b1b'; // red-800
                    messageModalText.style.color = '#991b1b'; // red-800
                }
                messageModal.classList.add('active');
            }
        }

        function hideMessage() {
            if (messageModal) messageModal.classList.remove('active');
        }

        if (closeMessageModalBtn) {
            closeMessageModalBtn.addEventListener('click', hideMessage);
        }

        if (messageModal) {
            messageModal.addEventListener('click', (e) => {
                if (e.target === messageModal) {
                    hideMessage();
                }
            });
        }

        // --- Modal Control Functions (General) ---
        function openModal(modalElement) {
            if (modalElement) {
                modalElement.classList.add('active');
            } else {
                console.warn("Attempted to open a null modal element.");
            }
        }

        function closeModal(modalElement) {
            if (modalElement) {
                modalElement.classList.remove('active');
            } else {
                console.warn("Attempted to close a null modal element.");
            }
        }

        // --- Mobile Menu Toggle and Close ---
        const mobileMenuButton = document.getElementById('mobileMenuButton');
        const mobileMenu = document.getElementById('mobileMenu');
        const closeMobileMenuButton = document.getElementById('closeMobileMenuButton');

        const closeMobileMenu = () => {
            if (mobileMenu) {
                mobileMenu.classList.remove('opacity-100');
                mobileMenu.classList.add('opacity-0');
                // Use transitionend event to hide the menu after the transition completes
                mobileMenu.addEventListener('transitionend', () => {
                    mobileMenu.classList.add('hidden');
                }, { once: true }); // The { once: true } option ensures the listener is removed after it runs once
            }
        };

        if (mobileMenuButton) {
            mobileMenuButton.addEventListener('click', () => {
                if (mobileMenu) {
                    mobileMenu.classList.remove('hidden');
                    // Force reflow to ensure the transition starts correctly
                    void mobileMenu.offsetWidth;
                    setTimeout(() => mobileMenu.classList.add('opacity-100'), 10);
                }
            });
        }

        if (closeMobileMenuButton) {
            closeMobileMenuButton.addEventListener('click', closeMobileMenu);
        }
        // Attach closeMobileMenu to all mobile menu links
        document.querySelectorAll('#mobileMenu a[data-close-menu]').forEach(link => {
            link.addEventListener('click', closeMobileMenu);
        });


        // All main script logic moves inside DOMContentLoaded to ensure elements and Firebase are ready
        document.addEventListener('DOMContentLoaded', async () => {
            // --- Element Declarations (ensure they are available here) ---
            const investmentAmountInput = document.getElementById('investmentAmount');
            const investmentPlanSelect = document.getElementById('investmentPlan');
            const calculateBtn = document.getElementById('calculateBtn');
            const resultsDiv = document.getElementById('results');
            const displayInitialInvestment = document.getElementById('displayInitialInvestment');
            const displayTotalReturn = document.getElementById('displayTotalReturn');
            const displayPercentageReturn = document.getElementById('displayPercentageReturn');
            const errorMessageDiv = document.getElementById('errorMessage');
            const countdownElement = document.getElementById('countdown');
            const offerTimePeriodSpan = document.getElementById('offerTimePeriod'); // New element

            const planDetailModal = document.getElementById('planDetailModal');
            const closePlanDetailModalBtn = document.getElementById('closePlanDetailModalBtn');
            const investNowBtn = document.getElementById('investNowBtn');
            const planCards = document.querySelectorAll('.plan-card');

            const investModal = document.getElementById('investModal');
            // FIX: Corrected typo here from `document = document.getElementById`
            const closeInvestModalBtn = document.getElementById('closeInvestModalBtn');
            const investmentForm = document.getElementById('investmentForm');
            const invNameInput = document.getElementById('inv_name');
            const invEmailInput = document.getElementById('inv_email');
            const invMobileInput = document.getElementById('inv_mobile');
            const invAmountInput = document.getElementById('inv_amount');
            const invAmountValidationMessage = document.getElementById('invAmountValidationMessage');
            const invUtrNumberInput = document.getElementById('inv_utr_number');
            const paidUpiIdSelect = document.getElementById('paidUpiId');
            // Removed invBankAccountNameInput, invBankAccountInput, invIfscCodeInput, invUpiIdOptionalInput
            const invPlanHiddenInput = document.getElementById('inv_plan_hidden');
            const investFormPlanName = document.getElementById('investFormPlanName');
            const cancelInvestFormBtn = document.getElementById('cancelInvestFormBtn');
            const submitInvestmentBtn = document.getElementById('submitInvestmentBtn');

            const explorePlansBtn = document.getElementById('explorePlansBtn');

            const navAuthLinks = document.getElementById('navAuthLinks');
            const mobileNavAuthLinks = document.getElementById('mobileNavAuthLinks');

            const myInvestmentsModal = document.getElementById('myInvestmentsModal');
            const closeMyInvestmentsModalBtn = document.getElementById('closeMyInvestmentsModalBtn');
            const investmentsContainer = document.getElementById('investments-container');
            const noInvestmentsMessage = document.getElementById('no-investments-message');
            const currentUserIdDisplay = document.getElementById('current-user-id');

            const signInModal = document.getElementById('signInModal');
            const signUpModal = document.getElementById('signUpModal');
            const signInForm = document.getElementById('signInForm');
            const signUpForm = document.getElementById('signUpForm');
            const signInEmailInput = document.getElementById('signInEmail');
            const signInPasswordInput = document.getElementById('signInPassword');
            const signUpEmailInput = document.getElementById('signUpEmail');
            const signUpPasswordInput = document.getElementById('signUpPassword');
            const signUpConfirmPasswordInput = document.getElementById('signUpConfirmPassword');
            const signUpReferrerIdInput = document.getElementById('signUpReferrerId'); // Renamed from signUpReferralIdInput
            const switchToSignUpBtn = document.getElementById('switchToSignUp');
            const switchToSignInBtn = document.getElementById('switchToSignIn');
            const cancelSignInBtn = document.getElementById('cancelSignInBtn');
            const cancelSignUpBtn = document.getElementById('cancelSignUpBtn'); // Corrected typo
            const signInSubmitBtn = document.getElementById('signInSubmitBtn');
            const signUpSubmitBtn = document.getElementById('signUpSubmitBtn');


            // New Terms & Conditions elements
            const termsAndConditionsModal = document.getElementById('termsAndConditionsModal');
            const closeTermsAndConditionsModalBtn = document.getElementById('closeTermsAndConditionsModalBtn');
            const viewTermsLink = document.getElementById('viewTermsLink');
            const acceptTermsCheckbox = document.getElementById('acceptTerms');
            const closeTermsContentBtn = document.getElementById('closeTermsContentBtn');

            // New Investment Details Modal elements
            const investmentDetailsModal = document.getElementById('investmentDetailsModal');
            const closeInvestmentDetailsModalBtn = document.getElementById('closeInvestmentDetailsModalBtn');
            const detailModalPlanName = document.getElementById('detailModalPlanName');
            const detailInvestedAmount = document.getElementById('detailInvestedAmount');
            const detailMonthlyPayout = document.getElementById('detailMonthlyPayout');
            const detailProjectedTotalReturn = document.getElementById('detailProjectedTotalReturn');
            const detailInvestDate = document.getElementById('detailInvestDate');
            const detailPlanEndDate = document.getElementById('detailPlanEndDate');
            const detailPayoutReturnDate = document.getElementById('detailPayoutReturnDate');
            // Removed elements for UTR, UPI, Bank Account details

            // Where Your Money Works specific elements (now a modal)
            const whereMoneyWorksModal = document.getElementById('whereMoneyWorksModal');
            const closeWhereMoneyWorksModalBtn = document.getElementById('closeWhereMoneyWorksModalBtn');
            const learnMoreMoneyWorksBtn = document.getElementById('learnMoreMoneyWorksBtn'); // New button

            // Refer & Earn elements
            const referEarnModal = document.getElementById('referEarnModal');
            const closeReferEarnModalBtn = document.getElementById('closeReferEarnModalBtn');
            const yourReferralIdSpan = document.getElementById('yourReferralId');
            const yourReferralLinkSpan = document.getElementById('yourReferralLink'); // New element for referral link
            const referredUsersListDiv = document.getElementById('referredUsersList');
            const noReferredUsersMessage = document.getElementById('noReferredUsersMessage');
            const referEarnOpenBtn = document.getElementById('referEarnOpenBtn'); // Get the button to disable/enable
            const totalReferralEarningsSpan = document.getElementById('totalReferralEarnings'); // New: Total referral earnings display
            const referralOfferDetailsDiv = document.getElementById('referralOfferDetails'); // NEW: For dynamic referral offers

            // New: Bank Card Modal elements
            const bankCardModal = document.getElementById('bankCardModal');
            const closeBankCardModalBtn = document.getElementById('closeBankCardModalBtn');
            const bankCardForm = document.getElementById('bankCardForm');
            const bankAccountNameInput = document.getElementById('bankAccountName');
            const bankAccountNumberInput = document.getElementById('bankAccountNumber');
            const ifscCodeInput = document.getElementById('ifscCode');
            const upiIdOptionalInput = document.getElementById('upiIdOptional');
            const saveBankDetailsBtn = document.getElementById('saveBankDetailsBtn');
            const cancelBankDetailsBtn = document.getElementById('cancelBankDetailsBtn');
            const bankDetailsSavedMessage = document.getElementById('bankDetailsSavedMessage'); // New element
            const bankDetailsInstructionText = document.getElementById('bankDetailsInstructionText'); // New element
            const bankDetailsFormButtons = document.getElementById('bankDetailsFormButtons'); // New element for button container

            // NEW: Payment History Modal elements
            const paymentHistoryModal = document.getElementById('paymentHistoryModal');
            const closePaymentHistoryModalBtn = document.getElementById('closePaymentHistoryModalBtn');
            const paymentHistoryContainer = document.getElementById('payment-history-container');
            const noPaymentHistoryMessage = document.getElementById('no-payment-history-message');

            // NEW: UPI Payment elements in Invest Modal
            const upiQrCodeImg = document.getElementById('upiQrCode');
            const upiAppButtons = document.querySelectorAll('.upi-app-button');

            // New: Dynamic Header Text elements
            const dynamicHeaderText = document.getElementById('dynamicHeaderText');
            const motivationalPhrases = [
                "Unlock Your Financial Potential",
                "Experience Consistent Growth",
                "Your Future, Secured",
                "Invest Smart, Live Better"
            ];
            let currentPhraseIndex = 0;

            // New: User Membership Status element
            const userMembershipStatusSpan = document.getElementById('userMembershipStatus');

            // Your company's UPI IDs
            const companyUpiIds = [
                { id: "chowdhurybarnadip98-1@okicici", name: "Barnadip Chowdhury" },
                { id: "mr.4989@superyes", name: "Mr. 4989" } // Changed UPI ID
            ];
            // Removed `selectedCompanyUpi` from global scope as it will be selected inside the function.

            // NEW: Why Choose Us Detail Modal elements
            const whyChooseUsDetailModal = document.getElementById('whyChooseUsDetailModal');
            const closeWhyChooseUsDetailModalBtn = document.getElementById('closeWhyChooseUsDetailModalBtn');
            const whyChooseUsDetailModalTitle = document.getElementById('whyChooseUsDetailModalTitle');
            const whyChooseUsDetailModalContent = document.getElementById('whyChooseUsDetailModalContent');
            const whyChooseUsButtons = document.querySelectorAll('.why-choose-us-button');
            const closeWhyChooseUsDetailModalBtnBottom = document.getElementById('closeWhyChooseUsDetailModalBtnBottom');

            // Define referral bonus structure for dynamic display
            const referralBonusRates = {
                "Standard Plan": { standard: "1%", premium: "1%", elite: "1%" },
                "Premium 6-Month Plan": { standard: "1%", premium: "2%", elite: "5%" },
                "Elite 12-Month Plan": { standard: "1%", premium: "3%", elite: "7%" }
            };


            // --- Helper to generate a unique 6-digit number (optimized) ---
            // This function no longer queries Firestore in a loop, significantly improving performance.
            // The likelihood of a collision for a 6-digit ID is extremely low,
            // and the Firebase Auth UID ensures the user document itself is unique.
            async function generateUnique6DigitId() {
                const newId = String(Math.floor(100000 + Math.random() * 900000));
                console.log(`[generateUnique6DigitId] Generated ID: ${newId}`);
                return newId;
            }

            // Variable to temporarily store referredBy during signup
            let referredByDuringSignUp = null;

            // --- Handle referral link in URL on page load (initial check) ---
            const urlParams = new URLSearchParams(window.location.search);
            const referrerParam = urlParams.get('ref'); // Renamed from refParam
            if (referrerParam && /^\d{6}$/.test(referrerParam)) {
                referralIdFromUrl = referrerParam;
                console.log("Referrer ID detected (early):", referralIdFromUrl); // Debugging
            } else if (referrerParam) {
                console.warn("Invalid referrer ID format found in URL parameter (early): ", referrerParam); // Debugging
            }


            // --- Firebase Initialization and Initial Auth Attempt ---
            try {
                // HARDCODED Firebase config with the user-provided details
                const firebaseConfig = {
                    apiKey: "AIzaSyBFS4IF12Tr4ZN7n-xqHRwf5MM020zddvw",
  authDomain: "ownads-07.firebaseapp.com",
  databaseURL: "https://ownads-07-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "ownads-07",
  storageBucket: "ownads-07.firebasestorage.app",
  messagingSenderId: "274286517816",
  appId: "1:274286517816:web:d83478fdd4119d183d10cd",
  measurementId: "G-D5K9HCL8KB"
                };

                // CRITICAL: Set appId directly from the hardcoded firebaseConfig.projectId
                appId = firebaseConfig.projectId;
                console.log(`[Firebase Init] Determined appId for Firestore paths: ${appId}`); // Debugging: Log the determined appId

                // Ensure firebaseConfig is not empty before initializing
                if (Object.keys(firebaseConfig).length === 0 || !firebaseConfig.apiKey) {
                    throw new Error("Firebase configuration is incomplete or not found.");
                }

                app = initializeApp(firebaseConfig);
                auth = getAuth(app);
                db = getFirestore(app);

                // --- Crucial: Attempt initial sign-in anonymously ---
                await signInAnonymously(auth);
                console.log("[Firebase Init] Signed in anonymously.");


                onAuthStateChanged(auth, async (user) => {
                    console.log("[onAuthStateChanged] Triggered. User:", user ? user.uid : "null", "Anonymous:", user ? user.isAnonymous : "N/A");

                    // Set isAuthReady to true early within onAuthStateChanged, as soon as we know auth state is determined
                    isAuthReady = true;
                    console.log(`[onAuthStateChanged] isAuthReady set to: ${isAuthReady}`);
                    // updateAuthUI will be called after fetching user data, so it has the most up-to-date info


                    if (user) {
                        currentUserId = user.uid;
                        currentUserEmail = user.email;

                        const userDocRef = doc(db, `artifacts/${appId}/users/${currentUserId}`);

                        // Check if user document exists. If not, create it (for new sign-ups or existing users without profiles)
                        const userDocSnap = await getDoc(userDocRef);
                        if (!userDocSnap.exists() && !user.isAnonymous) {
                            console.log(`[onAuthStateChanged] User document for ${currentUserId} does not exist. Creating it.`);
                            // ADDED THIS LOG FOR DEBUGGING THE EXACT PATH
                            console.log(`[Firestore Write Attempt] Path: artifacts/${appId}/users/${currentUserId}`);
                            try {
                                const newCustomUserId = await generateUnique6DigitId(); // Optimized ID generation
                                await setDoc(userDocRef, {
                                    email: user.email,
                                    customUserId: newCustomUserId,
                                    referredBy: referredByDuringSignUp || null, // Use the global variable
                                    createdAt: serverTimestamp(),
                                    referralEarnings: { // Initialize referral earnings structure
                                        total: 0,
                                        investments: []
                                    },
                                    bankDetails: {} // Initialize empty bank details
                                });
                                console.log(`[onAuthStateChanged] User document created for ${user.uid} with custom ID ${newCustomUserId}.`);
                                currentUserCustomId = newCustomUserId; // Update global state
                                currentUserReferredBy = referredByDuringSignUp; // Update global state
                                referredByDuringSignUp = null; // Clear the temporary variable after use
                                // MODIFIED: Changed the message to remove "in Firestore"
                                showMessage('Profile Created!', 'Your user profile has been successfully created.', true);
                                // updateAuthUI will be called after fetching investments
                            } catch (error) {
                                console.error("[onAuthStateChanged: User Doc Creation Error]", error);
                                let errorMessage = error.message;
                                if (error.code === 'permission-denied') {
                                    errorMessage = 'Missing or insufficient permissions. This often means your Firestore Security Rules are too restrictive for creating user profiles. Please ensure the rule allows authenticated users to create documents in their own user path.';
                                }
                                showMessage('Profile Creation Failed', `Failed to create user profile: ${errorMessage}`, false);
                            }
                        } else if (userDocSnap.exists()) {
                            const userData = userDocSnap.data();
                            currentUserCustomId = userData.customUserId;
                            currentUserReferredBy = userData.referredBy || null;
                            currentUserReferralEarningsTotal = userData.referralEarnings?.total || 0; // Get referral earnings total
                            currentUserBankDetails = userData.bankDetails || {}; // Get bank details
                            console.log(`[onAuthStateChanged:onSnapshot] User ${currentUserId} data loaded. Custom ID: ${currentUserCustomId}, Referral Earnings: ${currentUserReferralEarningsTotal}, Bank Details:`, currentUserBankDetails);
                            // updateAuthUI will be called after fetching investments
                        } else {
                            console.log(`[onAuthStateChanged] User is anonymous or document already exists.`);
                        }


                        // Unsubscribe from previous listener if it exists
                        if (unsubscribeCurrentUserDoc) {
                            unsubscribeCurrentUserDoc();
                            console.log("[onAuthStateChanged] Unsubscribed from previous current user doc listener.");
                        }

                        // Now set up the real-time listener for the user document
                        unsubscribeCurrentUserDoc = onSnapshot(userDocRef, (docSnap) => {
                            if (docSnap.exists()) {
                                const userData = docSnap.data();
                                currentUserCustomId = userData.customUserId;
                                currentUserReferredBy = userData.referredBy || null;
                                currentUserReferralEarningsTotal = userData.referralEarnings?.total || 0; // Update earnings on snapshot
                                currentUserBankDetails = userData.bankDetails || {}; // Update bank details on snapshot
                                console.log(`[onAuthStateChanged:onSnapshot] User ${currentUserId} data updated. Custom ID: ${currentUserCustomId}, Referral Earnings: ${currentUserReferralEarningsTotal}, Bank Details:`, currentUserBankDetails);
                                // updateAuthUI will be called after fetching investments, which is done right after this block
                                if (referEarnModal && referEarnModal.classList.contains('active')) {
                                    displayYourReferralId();
                                    displayYourReferralLink(); // Call to update referral link display
                                    displayReferredUsers();
                                    displayTotalReferralEarnings(); // New: Update total earnings display
                                    displayDynamicReferralOffers(); // NEW: Update dynamic referral offers
                                }
                                if (bankCardModal && bankCardModal.classList.contains('active')) {
                                    // If bank card modal is open, re-populate it with latest data
                                    populateBankDetailsForm();
                                }
                                // Also update referral button state when user data changes
                                updateReferralButtonState();
                                updateUserMembershipDisplay(); // Update membership display on data change
                            } else {
                                // If doc disappears after creation, or was never created for some reason
                                console.warn(`[onAuthStateChanged:onSnapshot] User document for ${currentUserId} does not exist after initial check.`);
                                currentUserCustomId = null;
                                currentUserReferredBy = null;
                                currentUserReferralEarningsTotal = 0; // Clear earnings on doc disappearance
                                currentUserBankDetails = {}; // Clear bank details on doc disappearance
                                // updateAuthUI will be called after fetching investments
                                updateReferralButtonState(); // Update referral button state
                                updateUserMembershipDisplay(); // Update membership display on data change
                            }
                        }, (error) => {
                            console.error("[onAuthStateChanged:onSnapshot Error]", error);
                            // Only show error if the user is supposed to be logged in
                            if (user && !user.isAnonymous) {
                                showMessage('Data Fetch Error', `Failed to load user data: ${error.message}`, false);
                            }
                        });

                        // Fetch investments for the current user to determine their active plans
                        // This call ensures userCurrentPlans is updated before updateAuthUI
                        await fetchInvestmentsForReferralCheck();
                        updateAuthUI(user && !user.isAnonymous, currentUserEmail, currentUserCustomId);


                        if (referralIdFromUrl && signUpReferrerIdInput) {
                            signUpReferrerIdInput.value = referralIdFromUrl;
                            console.log("[onAuthStateChanged] User already logged in, pre-filled signup referrer ID (but not opening modal):", referralIdFromUrl);
                        }
                    } else {
                        // User logged out or is anonymous. Clear data.
                        currentUserId = null;
                        currentUserCustomId = null;
                        currentUserEmail = null;
                        currentUserReferredBy = null; // Clear referredBy on logout
                        currentUserReferralEarningsTotal = 0; // Clear earnings on logout
                        currentUserBankDetails = {}; // Clear bank details on logout
                        userCurrentPlans = []; // Clear user plans on logout
                        updateAuthUI(false); // Update UI to reflect logged out state
                        updateReferralButtonState();
                        updateUserMembershipDisplay(); // Update membership display on logout

                        // Clear investments and referred users display upon logout
                        if (investmentsContainer) {
                            investmentsContainer.innerHTML = '';
                            if (noInvestmentsMessage.parentNode !== investmentsContainer) {
                                investmentsContainer.appendChild(noInvestmentsMessage);
                            }
                            noInvestmentsMessage.textContent = 'Please sign in to view your investments.';
                            noInvestmentsMessage.style.display = 'block';
                        }
                        if (currentUserIdDisplay) currentUserIdDisplay.textContent = '';
                        if (referredUsersListDiv) {
                            referredUsersListDiv.innerHTML = '';
                            noReferredUsersMessage.textContent = 'Please sign in to view your referred users.';
                            noReferredUsersMessage.style.display = 'block';
                        }
                        if (yourReferralIdSpan) yourReferralIdSpan.textContent = 'Sign in to get your ID';
                        if (yourReferralLinkSpan) yourReferralLinkSpan.textContent = 'Sign in to get your link'; // Clear referral link
                        if (totalReferralEarningsSpan) totalReferralEarningsSpan.textContent = '₹0.00'; // Clear earnings display
                        if (referralOfferDetailsDiv) referralOfferDetailsDiv.innerHTML = `<p class="text-lg text-gray-700">Invest in any plan to unlock referral bonuses!</p>`; // Clear dynamic offers

                        // NEW: Clear payment history display upon logout
                        if (paymentHistoryContainer) {
                            paymentHistoryContainer.innerHTML = '';
                            if (noPaymentHistoryMessage.parentNode !== paymentHistoryContainer) {
                                paymentHistoryContainer.appendChild(noPaymentHistoryMessage);
                            }
                            noPaymentHistoryMessage.textContent = 'Please sign in to view your payment history.';
                            noPaymentHistoryMessage.style.display = 'block';
                        }

                        // --- Crucial: Unsubscribe from listeners on logout ---
                        if (unsubscribeInvestments) {
                            unsubscribeInvestments();
                            unsubscribeInvestments = null;
                            console.log("[onAuthStateChanged] Unsubscribed from investments listener.");
                        }
                        if (unsubscribeCurrentUserDoc) {
                            unsubscribeCurrentUserDoc();
                            unsubscribeCurrentUserDoc = null;
                            console.log("[onAuthStateChanged] Unsubscribed from current user document listener.");
                        }
                        // NEW: Unsubscribe from payment history listener
                        if (unsubscribePaymentHistory) {
                            unsubscribePaymentHistory();
                            unsubscribePaymentHistory = null;
                            console.log("[onAuthStateChanged] Unsubscribed from payment history listener.");
                        }

                        if (referralIdFromUrl && signUpReferrerIdInput) {
                            signUpReferrerIdInput.value = referralIdFromUrl;
                            if (!user) {
                                openModal(signUpModal);
                                console.log(`[onAuthStateChanged] Referral link: Opened signup modal with ID ${referralIdFromUrl} for new/anonymous user. Pre-filled value: ${signUpReferrerIdInput.value}`);
                            }
                        } else {
                            console.log("[onAuthStateChanged] No referrer ID in URL or user already authenticated for initial load.");
                        }
                    }
                });

            } catch (error) {
                console.error("[Firebase Init Error]", error);
                showMessage('Initialization Error', `Failed to initialize Firebase services: ${error.message}. Please ensure your Firebase project's API Key and other configuration are correct, and that Email/Password and Anonymous sign-in methods are enabled in your Firebase Authentication settings.`, false);
                isAuthReady = true; // Set to true even on error to unblock UI
                updateAuthUI(false);
                updateReferralButtonState();
                updateUserMembershipDisplay(); // Update membership display on error
            }

            // --- Dynamic Header Text Rotation ---
            function updateDynamicHeaderText() {
                if (dynamicHeaderText) {
                    dynamicHeaderText.classList.remove('active'); // Start fade out
                    setTimeout(() => {
                        currentPhraseIndex = (currentPhraseIndex + 1) % motivationalPhrases.length;
                        dynamicHeaderText.textContent = motivationalPhrases[currentPhraseIndex];
                        dynamicHeaderText.classList.add('active'); // Start fade in
                    }, 500); // Wait for fade out to complete before changing text
            }
            }
            if (dynamicHeaderText) {
                // FIX: Corrected typo from motivationalPhrationalPhrases to motivationalPhrases
                dynamicHeaderText.textContent = motivationalPhrases[currentPhraseIndex]; // Set initial text
                dynamicHeaderText.classList.add('active'); // Show initial text
                setInterval(updateDynamicHeaderText, 4000); // Change phrase every 4 seconds
            }


            // --- Event Listeners for Modals (moved here to ensure elements exist) ---
            closeSignInModalBtn?.addEventListener('click', () => closeModal(signInModal));
            closeSignUpModalBtn?.addEventListener('click', () => closeModal(signUpModal));
            cancelSignInBtn?.addEventListener('click', () => closeModal(signInModal));
            cancelSignUpBtn?.addEventListener('click', () => closeModal(signUpModal));

            switchToSignUpBtn?.addEventListener('click', (e) => {
                e.preventDefault();
                closeModal(signInModal);
                if (referralIdFromUrl && signUpReferrerIdInput) {
                    signUpReferrerIdInput.value = referralIdFromUrl;
                }
                openModal(signUpModal);
            });
            switchToSignInBtn?.addEventListener('click', (e) => {
                e.preventDefault();
                closeModal(signUpModal);
                openModal(signInModal);
            });

            closeMyInvestmentsModalBtn?.addEventListener('click', () => {
                closeModal(myInvestmentsModal);
            });
            // Close Investment Details Modal
            closeInvestmentDetailsModalBtn?.addEventListener('click', () => {
                closeModal(investmentDetailsModal);
            });
            if (investmentDetailsModal) {
                investmentDetailsModal.addEventListener('click', (e) => {
                    if (e.target === investmentDetailsModal) {
                        closeModal(investmentDetailsModal);
                    }
                });
            }

            // Terms and Conditions Modal event listeners
            if (viewTermsLink) {
                viewTermsLink.addEventListener('click', (e) => {
                    e.preventDefault();
                    openModal(termsAndConditionsModal);
                });
            }

            if (closeTermsAndConditionsModalBtn) {
                closeTermsAndConditionsModalBtn.addEventListener('click', () => closeModal(termsAndConditionsModal));
            }
             if (closeTermsContentBtn) {
                closeTermsContentBtn.addEventListener('click', () => closeModal(termsAndConditionsModal));
            }
            if (termsAndConditionsModal) {
                termsAndConditionsModal.addEventListener('click', (e) => {
                    if (e.target === termsAndConditionsModal) {
                        closeModal(termsAndConditionsModal);
                    }
                });
            }

            // Where Your Money Works Modal event listeners (now triggered by a button)
            if (learnMoreMoneyWorksBtn) {
                learnMoreMoneyWorksBtn.addEventListener('click', () => {
                    openModal(whereMoneyWorksModal);
                });
            }
            if (closeWhereMoneyWorksModalBtn) {
                    closeWhereMoneyWorksModalBtn.addEventListener('click', () => closeModal(whereMoneyWorksModal));
                }
            if (whereMoneyWorksModal) {
                whereMoneyWorksModal.addEventListener('click', (e) => {
                    if (e.target === whereMoneyWorksModal) {
                        closeModal(whereMoneyWorksModal);
                    }
                });
            }

            // New: Refer & Earn Modal event listeners
            if (closeReferEarnModalBtn) {
                closeReferEarnModalBtn.addEventListener('click', () => closeModal(referEarnModal));
            }
            if (referEarnModal) {
                referEarnModal.addEventListener('click', (e) => {
                    if (e.target === referEarnModal) {
                        closeModal(referEarnModal);
                    }
                });
            }

            // New: Bank Card Modal event listeners
            if (closeBankCardModalBtn) {
                closeBankCardModalBtn.addEventListener('click', () => closeModal(bankCardModal));
            }
            if (cancelBankDetailsBtn) {
                cancelBankDetailsBtn.addEventListener('click', () => closeModal(bankCardModal));
            }
            if (bankCardModal) {
                bankCardModal.addEventListener('click', (e) => {
                    if (e.target === bankCardModal) {
                        closeModal(bankCardModal);
                    }
                });
            }

            // NEW: Payment History Modal event listeners
            if (closePaymentHistoryModalBtn) {
                closePaymentHistoryModalBtn.addEventListener('click', () => closeModal(paymentHistoryModal));
            }
            if (paymentHistoryModal) {
                paymentHistoryModal.addEventListener('click', (e) => {
                    if (e.target === paymentHistoryModal) {
                        closeModal(paymentHistoryModal);
                    }
                });
            }

            // NEW: Why Choose Us Detail Modal event listeners
            if (closeWhyChooseUsDetailModalBtn) {
                closeWhyChooseUsDetailModalBtn.addEventListener('click', () => closeModal(whyChooseUsDetailModal));
            }
            if (closeWhyChooseUsDetailModalBtnBottom) {
                closeWhyChooseUsDetailModalBtnBottom.addEventListener('click', () => closeModal(whyChooseUsDetailModal));
            }
            if (whyChooseUsDetailModal) {
                whyChooseUsDetailModal.addEventListener('click', (e) => {
                    if (e.target === whyChooseUsDetailModal) {
                        closeModal(whyChooseUsDetailModal);
                    }
                });
            }


            // Sign Up Form Submission
            signUpForm?.addEventListener('submit', async (e) => {
                e.preventDefault();
                console.log("[Sign Up] Form submitted.");

                if (!isAuthReady) {
                    showMessage('Sign Up Failed', 'Firebase Authentication is not ready. Please wait a moment and try again.', false);
                    if (signUpSubmitBtn) {
                        signUpSubmitBtn.disabled = false;
                        signUpSubmitBtn.textContent = 'Sign Up';
                    }
                    return;
                }

                if (signUpSubmitBtn) {
                    signUpSubmitBtn.disabled = true;
                    signUpSubmitBtn.textContent = 'Processing...';
                }

                const email = signUpEmailInput.value;
                const password = signUpPasswordInput.value;
                const confirmPassword = signUpConfirmPasswordInput.value;
                referredByDuringSignUp = signUpReferrerIdInput.value.trim(); // Capture referrer ID from signup form
                console.log(`[Sign Up] Email: ${email}, Referrer ID: ${referredByDuringSignUp}`);

                if (password !== confirmPassword) {
                    showMessage('Sign Up Failed', 'Passwords do not match.', false);
                    if (signUpSubmitBtn) {
                        signUpSubmitBtn.disabled = false;
                        signUpSubmitBtn.textContent = 'Sign Up';
                    }
                    return;
                }
                if (password.length < 6) {
                    showMessage('Sign Up Failed', 'Password should be at least 6 characters.', false);
                    if (signUpSubmitBtn) {
                        signUpSubmitBtn.disabled = false;
                        signUpSubmitBtn.textContent = 'Sign Up';
                    }
                    return;
                }

                if (!auth || !db) {
                    showMessage('Sign Up Failed', 'Firebase services are not ready. Please wait a moment and try again.', false);
                    if (signUpSubmitBtn) {
                        signUpSubmitBtn.disabled = false;
                        signUpSubmitBtn.textContent = 'Sign Up';
                    }
                    return;
                }

                try {
                    if (referredByDuringSignUp && !/^\d{6}$/.test(referredByDuringSignUp)) {
                        showMessage('Sign Up Failed', 'Referrer ID must be a 6-digit number if provided.', false);
                        if (signUpSubmitBtn) {
                            signUpSubmitBtn.disabled = false;
                            signUpSubmitBtn.textContent = 'Sign Up';
                        }
                        return;
                    }

                    // Only create the Firebase Auth user. Firestore document creation will be handled by onAuthStateChanged.
                    await createUserWithEmailAndPassword(auth, email, password);
                    console.log(`[Sign Up] Firebase user created. onAuthStateChanged will handle document creation.`);

                    // Show success message immediately, as Auth user is created.
                    // The profile creation message will come from onAuthStateChanged.
                    // MODIFIED: Changed the message to remove "in Firestore"
                    showMessage('Sign Up Successful', `Your account has been created! Your User ID will appear shortly. You are now signed in.`, true);
                    closeModal(signUpModal);
                    signUpForm.reset();
                    // referredByDuringSignUp is NOT cleared here, it will be cleared in onAuthStateChanged after use.

                } catch (error) {
                    console.error("[Sign Up Error]", error);
                    let errorMessage = error.message;
                    if (error.code === 'auth/operation-not-allowed') {
                        errorMessage = 'Email/Password sign-in is not enabled. Please enable it in your Firebase project\'s Authentication settings (under "Sign-in method").';
                    } else if (error.code === 'auth/email-already-in-use') {
                        errorMessage = 'The email address is already in use by another account.';
                    } else if (error.code === 'auth/invalid-email') {
                        errorMessage = 'The email address is not valid.';
                    } else if (error.code === 'permission-denied') {
                        errorMessage = 'Permission denied. This often means your Firestore Security Rules are too restrictive for creating user profiles. Please ensure the rule allows authenticated users to create documents in their own user path.';
                    }
                    showMessage('Sign Up Failed', errorMessage, false);
                } finally {
                    if (signUpSubmitBtn) {
                        signUpSubmitBtn.disabled = false;
                        signUpSubmitBtn.textContent = 'Sign Up';
                    }
                }
            });

            // Sign In Form Submission
            signInForm?.addEventListener('submit', async (e) => {
                e.preventDefault();
                console.log("[Sign In] Form submitted.");

                if (!isAuthReady) {
                    showMessage('Sign In Failed', 'Firebase Authentication is not ready. Please wait a moment and try again.', false);
                    if (signInSubmitBtn) {
                        signInSubmitBtn.disabled = false;
                        signInSubmitBtn.textContent = 'Sign In';
                    }
                    return;
                }

                if (signInSubmitBtn) {
                    signInSubmitBtn.disabled = true;
                    signInSubmitBtn.textContent = 'Sign In';
                }

                const email = signInEmailInput.value;
                const password = signInPasswordInput.value;

                if (!auth) {
                    showMessage('Sign In Failed', 'Firebase Authentication is not ready. Please try again.', false);
                    if (signInSubmitBtn) {
                        signInSubmitBtn.disabled = false;
                        signInSubmitBtn.textContent = 'Sign In';
                    }
                    return;
                }

                try {
                    const userCredential = await signInWithEmailAndPassword(auth, email, password);
                    currentUserId = userCredential.user.uid;
                    console.log(`[Sign In] User signed in with UID: ${currentUserId}`);

                    // When signing in, ensure the user has a custom ID and referralEarnings structure.
                    const userDocRef = doc(db, `artifacts/${appId}/users/${currentUserId}`);
                    const userDocSnap = await getDoc(userDocRef);
                    if (userDocSnap.exists()) {
                        const userData = userDocSnap.data();
                        currentUserCustomId = userData.customUserId;
                        currentUserReferredBy = userData.referredBy || null;
                        currentUserReferralEarningsTotal = userData.referralEarnings?.total || 0; // Get earnings
                        currentUserBankDetails = userData.bankDetails || {}; // Get bank details
                        console.log(`[Sign In] Fetched custom ID, earnings, and bank details for signed-in user: ${currentUserCustomId}, Earnings: ${currentUserReferralEarningsTotal}, Bank Details:`, currentUserBankDetails);
                    } else {
                        console.warn("[Sign In] User doc or customUserId/referralEarnings/bankDetails not found for existing user. Generating one.");
                        const newCustomUserId = await generateUnique6DigitId(); // Optimized ID generation
                        await setDoc(userDocRef, {
                            customUserId: newCustomUserId,
                            email: email,
                            createdAt: serverTimestamp(),
                            referralEarnings: { // Initialize referral earnings structure
                                total: 0,
                                investments: []
                            },
                            bankDetails: {} // Initialize empty bank details
                        }, { merge: true });
                        currentUserCustomId = newCustomUserId;
                        currentUserReferredBy = null; // No referrer for this fallback creation
                        currentUserReferralEarningsTotal = 0; // Initialize earnings
                        currentUserBankDetails = {}; // Initialize empty bank details
                        console.log(`[Sign In] Generated new custom ID and initialized earnings/bank details for existing user without one: ${currentUserCustomId}`);
                    }

                    showMessage('Sign In Successful', 'You are now signed in!', true);
                    closeModal(signInModal);
                    signInForm.reset();
                } catch (error) {
                    console.error("[Sign In Error]", error);
                    let errorMessage = error.message;
                    if (error.code === 'auth/user-not-found' || error.code === 'auth/invalid-credential') {
                        errorMessage = 'Invalid email or password.';
                    } else if (error.code === 'auth/wrong-password') {
                        errorMessage = 'Wrong password.';
                    } else if (error.code === 'auth/invalid-email') {
                        errorMessage = 'The email address is not valid.';
                    }
                    showMessage('Sign In Failed', errorMessage, false);
                } finally {
                    if (signInSubmitBtn) {
                        signInSubmitBtn.disabled = false;
                        signInSubmitBtn.textContent = 'Sign In';
                    }
                }
            });


            // --- Auth UI Update Function ---
            function updateAuthUI(loggedIn, email = '', customId = null) {
                console.log(`[Auth UI] Updating UI. LoggedIn: ${loggedIn}, Email: ${email}, Custom ID: ${customId}`);
                const myInvestmentsLink = `<li><button id="myInvestmentsOpenBtn" class="bg-purple-500 hover:bg-purple-600 text-white font-bold py-2 px-4 rounded-full transition duration-300 button-effect">My Investments</button></li>`;
                // Conditional rendering for Payment History
                const paymentHistoryLink = userCurrentPlans.length > 0 ?
                    `<li><button id="paymentHistoryOpenBtn" class="bg-orange-500 hover:bg-orange-600 text-white font-bold py-2 px-4 rounded-full transition duration-300 button-effect">Payment History</button></li>` : '';
                const referEarnLink = `<li><button id="referEarnOpenBtn" class="bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-2 px-4 rounded-full transition duration-300 button-effect">Refer & Earn</button></li>`; // Updated button text
                const bankCardLink = `<li><button id="bankCardOpenBtn" class="bg-teal-500 hover:bg-teal-600 text-white font-bold py-2 px-4 rounded-full transition duration-300 button-effect">Bank Card</button></li>`; // New: Bank Card button
                const signOutLink = `<li><button id="signOutBtn" class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-full transition duration-300 button-effect">Sign Out</button></li>`;
                const loggedOutLinks = `
                    <li><button id="signInOpenBtn" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-full transition duration-300 button-effect">Sign In</button></li>
                    <li><button id="signUpOpenBtn" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-full transition duration-300 button-effect">Sign Up</button></li>
                `;

                if (navAuthLinks) {
                    navAuthLinks.innerHTML = loggedIn ? `${myInvestmentsLink}${paymentHistoryLink}${referEarnLink}${bankCardLink}${signOutLink}` : loggedOutLinks;
                } else {
                    console.warn("navAuthLinks element not found.");
                }

                if (mobileNavAuthLinks) {
                    mobileNavAuthLinks.innerHTML = loggedIn ? `${myInvestmentsLink}${paymentHistoryLink}${referEarnLink}${bankCardLink}${signOutLink}` : loggedOutLinks;
                } else {
                    console.warn("mobileNavAuthLinks element not found.");
                }

                // Re-attach event listeners after innerHTML update
                document.getElementById('signOutBtn')?.addEventListener('click', async () => {
                    try {
                        await signOut(auth);
                        showMessage('Signed Out', 'You have been successfully signed out.', true);
                        closeMobileMenu();
                    } catch (error) {
                        console.error("[Sign Out Error]", error);
                        showMessage('Sign Out Failed', error.message, false);
                    }
                });

                const newSignInOpenBtn = document.getElementById('signInOpenBtn');
                const newSignUpOpenBtn = document.getElementById('signUpOpenBtn');
                const newMobileSignInOpenBtn = document.querySelector('#mobileNavAuthLinks #signInOpenBtn');
                const newMobileSignUpOpenBtn = document.querySelector('#mobileNavAuthLinks #signUpOpenBtn');

                if (newSignInOpenBtn) {
                    newSignInOpenBtn.addEventListener('click', () => openModal(signInModal));
                    newSignInOpenBtn.classList.toggle('button-disabled', !isAuthReady);
                }
                if (newSignUpOpenBtn) {
                    newSignUpOpenBtn.addEventListener('click', () => openModal(signUpModal));
                    newSignUpOpenBtn.classList.toggle('button-disabled', !isAuthReady);
                }
                 if (newMobileSignInOpenBtn) {
                    newMobileSignInOpenBtn.addEventListener('click', () => {
                        openModal(signInModal);
                        closeMobileMenu();
                    });
                    newMobileSignInOpenBtn.classList.toggle('button-disabled', !isAuthReady);
                }
                if (newMobileSignUpOpenBtn) {
                    newMobileSignUpOpenBtn.addEventListener('click', () => {
                        openModal(signUpModal);
                        closeMobileMenu();
                    });
                    newMobileSignUpOpenBtn.classList.toggle('button-disabled', !isAuthReady);
                }


                document.getElementById('myInvestmentsOpenBtn')?.addEventListener('click', () => {
                    openModal(myInvestmentsModal);
                    closeMobileMenu();
                    fetchInvestments();
                });

                // Attach listener for Refer & Track button
                document.getElementById('referEarnOpenBtn')?.addEventListener('click', () => {
                    openModal(referEarnModal);
                    closeMobileMenu();
                    displayYourReferralId();
                    displayYourReferralLink(); // Call to update referral link display
                    displayReferredUsers();
                    displayTotalReferralEarnings(); // New: Call to update total earnings display
                    displayDynamicReferralOffers(); // NEW: Call to update dynamic referral offers
                });

                // New: Attach listener for Bank Card button
                document.getElementById('bankCardOpenBtn')?.addEventListener('click', () => {
                    openModal(bankCardModal);
                    closeMobileMenu();
                    populateBankDetailsForm(); // Populate form when modal opens
                });

                // NEW: Attach listener for Payment History button
                // This button will only exist if userCurrentPlans.length > 0
                document.getElementById('paymentHistoryOpenBtn')?.addEventListener('click', () => {
                    openModal(paymentHistoryModal);
                    closeMobileMenu();
                    fetchPaymentHistory(); // Fetch and display payment history
                });


                // Mobile menu specific listeners
                document.querySelector('#mobileNavAuthLinks #signOutBtn')?.addEventListener('click', async () => {
                     try {
                        await signOut(auth);
                        showMessage('Signed Out', 'You have been successfully signed out.', true);
                        closeMobileMenu();
                    } catch (error) {
                        console.error("[Sign Out Error]", error);
                        showMessage('Sign Out Failed', error.message, false);
                    }
                });

                document.querySelector('#mobileNavAuthLinks #myInvestmentsOpenBtn')?.addEventListener('click', () => {
                    openModal(myInvestmentsModal);
                    closeMobileMenu();
                    fetchInvestments();
                });
                document.querySelector('#mobileNavAuthLinks #referEarnOpenBtn')?.addEventListener('click', () => {
                    openModal(referEarnModal);
                    closeMobileMenu();
                    displayYourReferralId();
                    displayYourReferralLink(); // Call to update referral link
                    displayReferredUsers();
                    displayTotalReferralEarnings(); // New: Call to update total earnings
                    displayDynamicReferralOffers(); // NEW: Call to update dynamic referral offers
                });
                // New: Mobile Bank Card button listener
                document.querySelector('#mobileNavAuthLinks #bankCardOpenBtn')?.addEventListener('click', () => {
                    openModal(bankCardModal);
                    closeMobileMenu();
                    populateBankDetailsForm();
                });
                // NEW: Mobile Payment History button listener
                // This button will only exist if userCurrentPlans.length > 0
                document.querySelector('#mobileNavAuthLinks #paymentHistoryOpenBtn')?.addEventListener('click', () => {
                    openModal(paymentHistoryModal);
                    closeMobileMenu();
                    fetchPaymentHistory();
                });


                if (loggedIn) {
                    if (currentUserIdDisplay) currentUserIdDisplay.textContent = `Logged in: ${email || 'Guest'} (ID: ${customId || 'N/A'})`;
                    if (invNameInput) invNameInput.value = '';
                    if (invEmailInput) invEmailInput.value = email;
                    if (yourReferralIdSpan) yourReferralIdSpan.textContent = customId || 'N/A';
                    if (yourReferralLinkSpan) yourReferralLinkSpan.textContent = `${window.location.origin}/?ref=${customId || 'N/A'}`; // Set referral link
                    if (totalReferralEarningsSpan) totalReferralEarningsSpan.textContent = `₹${currentUserReferralEarningsTotal.toFixed(2)}`; // Set earnings
                } else {
                    if (currentUserIdDisplay) currentUserIdDisplay.textContent = '';
                    if (invEmailInput) invEmailInput.value = '';
                    if (yourReferralIdSpan) yourReferralIdSpan.textContent = 'Sign in to get your ID';
                    if (yourReferralLinkSpan) yourReferralLinkSpan.textContent = 'Sign in to get your link'; // Clear referral link
                    if (totalReferralEarningsSpan) totalReferralEarningsSpan.textContent = '₹0.00'; // Clear earnings display
                }
                updateReferralButtonState(); // Call this after UI updates
                updateUserMembershipDisplay(); // Call this after auth state changes
            }

            // --- Update Referral Button State ---
            function updateReferralButtonState() {
                const referEarnButton = document.getElementById('referEarnOpenBtn');
                if (!referEarnButton) return;

                // Check if the user is logged in and has at least one Premium or Elite plan
                const canRefer = currentUserId && userCurrentPlans.some(plan => plan === 'Premium 6-Month Plan' || plan === 'Elite 12-Month Plan' || plan === 'Standard Plan'); // Standard plan can also refer now

                if (canRefer) {
                    referEarnButton.classList.remove('button-disabled');
                    referEarnButton.title = ''; // Clear any previous title
                } else {
                    referEarnButton.classList.add('button-disabled');
                    referEarnButton.title = 'You need to invest in any plan to use the referral program.'; // Updated message
                }

                // Also update mobile button if it exists
                const mobileReferEarnButton = document.querySelector('#mobileNavAuthLinks #referEarnOpenBtn');
                if (mobileReferEarnButton) {
                    if (canRefer) {
                        mobileReferEarnButton.classList.remove('button-disabled');
                        mobileReferEarnButton.title = '';
                    } else {
                        mobileReferEarnButton.classList.add('button-disabled');
                        mobileReferEarnButton.title = 'You need to invest in any plan to use the referral program.'; // Updated message
                    }
                }
            }

            // --- NEW: Update User Membership Display in Header ---
            function updateUserMembershipDisplay() {
                if (!userMembershipStatusSpan) {
                    console.warn("[updateUserMembershipDisplay] userMembershipStatusSpan element not found.");
                    return;
                }

                if (!currentUserId || (auth && auth.currentUser && auth.currentUser.isAnonymous) || !isAuthReady) {
                    userMembershipStatusSpan.textContent = '';
                    userMembershipStatusSpan.classList.add('hidden');
                    return;
                }

                let membershipText = "Invest to Become a Member!"; // Default for logged-in but no active plan

                if (userCurrentPlans.includes("Elite 12-Month Plan")) {
                    membershipText = "Elite Member 👑";
                } else if (userCurrentPlans.includes("Premium 6-Month Plan")) {
                    membershipText = "Premium Member ⭐";
                } else if (userCurrentPlans.includes("Standard Plan")) {
                    membershipText = "Standard Member 🛡️";
                }

                userMembershipStatusSpan.textContent = membershipText;
                userMembershipStatusSpan.classList.remove('hidden');
            }


            // --- Fetch Investments for Referral Check (non-UI update version) ---
            async function fetchInvestmentsForReferralCheck() {
                if (!currentUserId || !db) {
                    userCurrentPlans = [];
                    updateReferralButtonState();
                    updateUserMembershipDisplay(); // Update membership display
                    return;
                }

                try {
                    const userInvestmentsCollectionRef = collection(db, `artifacts/${appId}/users/${currentUserId}/investments`);
                    const querySnapshot = await getDocs(userInvestmentsCollectionRef);
                    
                    const plans = new Set();
                    querySnapshot.forEach(doc => {
                        const investment = doc.data();
                        plans.add(investment.planName);
                    });
                    userCurrentPlans = Array.from(plans);
                    console.log("[fetchInvestmentsForReferralCheck] User's current plans:", userCurrentPlans);
                    updateReferralButtonState(); // Update button state after fetching plans
                    updateUserMembershipDisplay(); // Update membership display after fetching plans

                } catch (error) {
                    console.error("[fetchInvestmentsForReferralCheck Error]", error);
                    userCurrentPlans = []; // Reset on error
                    updateReferralButtonState();
                    updateUserMembershipDisplay(); // Update membership display
                }
            }


            // --- Display Your Referrer ID in Modal ---
            function displayYourReferralId() {
                console.log(`[Referrer ID Display] Current User Custom ID: ${currentUserCustomId}`);
                if (yourReferralIdSpan && currentUserCustomId) {
                    yourReferralIdSpan.textContent = currentUserCustomId;
                } else if (yourReferralIdSpan) {
                    yourReferralIdSpan.textContent = 'Sign in to get your ID';
                }
            }

            // --- Display Your Referral Link in Modal ---
            function displayYourReferralLink() {
                console.log(`[Referral Link Display] Current User Custom ID: ${currentUserCustomId}`);
                if (yourReferralLinkSpan && currentUserCustomId) {
                    // Use window.location.origin to get the base URL (e.g., https://your-site.com)
                    yourReferralLinkSpan.textContent = `${window.location.origin}/?ref=${currentUserCustomId}`;
                } else if (yourReferralLinkSpan) {
                    yourReferralLinkSpan.textContent = 'Sign in to get your link';
                }
            }

            // --- Display Total Referral Earnings ---
            function displayTotalReferralEarnings() {
                console.log(`[Total Referral Earnings Display] Current User Total Earnings: ${currentUserReferralEarningsTotal}`);
                if (totalReferralEarningsSpan) {
                    totalReferralEarningsSpan.textContent = `₹${currentUserReferralEarningsTotal.toFixed(2)}`;
                }
            }

            // --- NEW: Function to determine highest membership level ---
            function getHighestMembershipLevel() {
                if (userCurrentPlans.includes("Elite 12-Month Plan")) {
                    return "Elite 12-Month Plan";
                } else if (userCurrentPlans.includes("Premium 6-Month Plan")) {
                    return "Premium 6-Month Plan";
                } else if (userCurrentPlans.includes("Standard Plan")) {
                    return "Standard Plan";
                }
                return "Not a Member";
            }

            // --- NEW: Function to display dynamic referral offers in the modal ---
            function displayDynamicReferralOffers() {
                if (!referralOfferDetailsDiv) {
                    console.warn("[displayDynamicReferralOffers] referralOfferDetailsDiv element not found.");
                    return;
                }

                const highestPlan = getHighestMembershipLevel();
                let content = '';

                if (highestPlan === "Not a Member") {
                    content = `<p class="text-lg text-gray-700">Invest in any plan to unlock referral bonuses!</p>`;
                } else {
                    const rates = referralBonusRates[highestPlan];
                    content = `<p class="text-lg font-semibold text-blue-700 mb-2">Your current membership level: <span class="text-green-600">${highestPlan}</span></p>`;
                    content += `<p class="text-lg text-gray-700 mb-3">As a ${highestPlan.replace(' Plan', '')} Investor, you earn:</p>`;
                    content += `<ul class="list-disc list-inside ml-4 text-gray-700 space-y-1">`;
                    if (rates.standard) content += `<li>${rates.standard} of investment for Standard Plan referrals</li>`;
                    if (rates.premium) content += `<li>${rates.premium} of investment for Premium 6-Month Plan referrals</li>`;
                    if (rates.elite) content += `<li>${rates.elite} of investment for Elite 12-Month Plan referrals</li>`;
                    content += `</ul>`;
                }
                referralOfferDetailsDiv.innerHTML = content;
            }


            // --- Display Referred Users ---
            async function displayReferredUsers() {
                console.log(`[Display Referred Users] Current User Custom ID: ${currentUserCustomId}`);

                const referredUsersList = document.getElementById('referredUsersList');
                const noReferredUsersMessage = document.getElementById('noReferredUsersMessage');

                if (!referredUsersList || !noReferredUsersMessage) {
                    console.warn("[Display Referred Users] Required DOM elements not found.");
                    return;
                }

                if (!isAuthReady || !currentUserId || (auth && auth.currentUser && auth.currentUser.isAnonymous) || !db || !currentUserCustomId) {
                    console.log("[Display Referred Users] Auth not ready, not a registered user, anonymous, or Firestore/custom ID not ready. Cannot display referred users.");
                    referredUsersList.innerHTML = '';
                    noReferredUsersMessage.textContent = 'Please sign in to view your referred users.';
                    noReferredUsersMessage.style.display = 'block';
                    return;
                }

                referredUsersList.innerHTML = '';
                noReferredUsersMessage.style.display = 'block';

                try {
                    const usersCollectionRef = collection(db, `artifacts/${appId}/users`);
                    const q = query(usersCollectionRef, where("referredBy", "==", currentUserCustomId));
                    const querySnapshot = await getDocs(q);

                    if (querySnapshot.empty) {
                        console.log("[Display Referred Users] No users referred by this user.");
                        noReferredUsersMessage.textContent = 'No users referred yet. Share your ID!';
                        noReferredUsersMessage.style.display = 'block';
                    } else {
                        console.log(`[Display Referred Users] Found ${querySnapshot.size} referred users.`);
                        noReferredUsersMessage.style.display = 'none';

                        const referredUsers = [];
                        querySnapshot.forEach(doc => {
                            const userData = doc.data();
                            referredUsers.push({
                                customUserId: userData.customUserId,
                                email: userData.email,
                                createdAt: userData.createdAt // Keep original timestamp for sorting
                            });
                        });

                        referredUsers.sort((a, b) => {
                            const dateA = a.createdAt && a.createdAt.toDate ? a.createdAt.toDate() : new Date(0);
                            const dateB = b.createdAt && b.createdAt.toDate ? b.createdAt.toDate() : new Date(0);
                            return dateB.getTime() - dateA.getTime();
                        });

                        referredUsers.forEach(user => {
                            const formattedJoinedDate = user.createdAt && user.createdAt.toDate ? user.createdAt.toDate().toLocaleDateString() : 'N/A';
                            const card = `
                                <div class="referred-user-card">
                                    <p>User ID: <span class="referred-user-id-text">${user.customUserId || 'N/A'}</span></p>
                                    <p class="text-xs text-gray-500">Email: ${user.email || 'N/A'}</p>
                                    <p class="text-xs text-gray-500">Joined Date: ${formattedJoinedDate}</p>
                                </div>
                            `;
                            referredUsersList.insertAdjacentHTML('beforeend', card);
                        });
                    }
                } catch (error) {
                    console.error("[Display Referred Users Error]", error);
                    referredUsersList.innerHTML = '';
                    noReferredUsersMessage.textContent = `Error loading referred users: ${error.message}`;
                    noReferredUsersMessage.style.display = 'block';
                }
            }


            // --- Fetch and Display Investments ---
            function fetchInvestments() {
                if (!isAuthReady || !currentUserId || (auth && auth.currentUser && auth.currentUser.isAnonymous) || !db) {
                    console.log("[Fetch Investments] Auth not ready, not a registered user, anonymous, or Firestore is not ready. Cannot fetch investments.");
                    if (investmentsContainer && noInvestmentsMessage) {
                        investmentsContainer.innerHTML = '';
                        if (noInvestmentsMessage.parentNode !== investmentsContainer) {
                            investmentsContainer.appendChild(noInvestmentsMessage);
                        }
                        noInvestmentsMessage.textContent = 'Please sign in to view your investments.';
                        noInvestmentsMessage.style.display = 'block';
                    }
                    if (currentUserIdDisplay) currentUserIdDisplay.textContent = '';
                    return;
                }

                if (investmentsContainer) {
                    investmentsContainer.innerHTML = '<p class="text-center text-lg text-gray-600 col-span-full">Loading your investments...</p>';
                    noInvestmentsMessage.style.display = 'none';
                }
                if (currentUserIdDisplay) currentUserIdDisplay.textContent = `User ID: ${currentUserCustomId || currentUserId}`;
                console.log(`[Fetch Investments] Attempting to fetch investments for user UID: ${currentUserId}, Custom ID: ${currentUserCustomId} in path: artifacts/${appId}/users/${currentUserId}/investments`);

                const userInvestmentsRef = collection(db, `artifacts/${appId}/users/${currentUserId}/investments`);
                const q = query(userInvestmentsRef);

                if (unsubscribeInvestments) {
                    unsubscribeInvestments();
                    console.log("[Fetch Investments] Unsubscribed from previous investments listener.");
                }

                unsubscribeInvestments = onSnapshot(q, (snapshot) => {
                    userInvestmentsData = [];
                    if (snapshot.empty) {
                        console.log("[Fetch Investments] No investments found for this user.");
                        if (investmentsContainer && noInvestmentsMessage) {
                            investmentsContainer.innerHTML = '';
                            if (noInvestmentsMessage.parentNode !== investmentsContainer) {
                                investmentsContainer.appendChild(noInvestmentsMessage);
                            }
                            noInvestmentsMessage.textContent = 'You have no investments yet. Start investing today!';
                            noInvestmentsMessage.style.display = 'block';
                        }
                    } else {
                        if (investmentsContainer) investmentsContainer.innerHTML = '';
                        noInvestmentsMessage.style.display = 'none';
                        snapshot.forEach((doc) => {
                            const investment = doc.data();
                            const docId = doc.id;
                            investment.id = docId;
                            userInvestmentsData.push(investment);
                            console.log(`[Fetch Investments] Fetched investment:`, investment);
                        });

                        userInvestmentsData.sort((a, b) => {
                            const dateA = a.timestamp && a.timestamp.toDate ? a.timestamp.toDate() : new Date(0);
                            const dateB = b.timestamp && b.timestamp.toDate ? b.timestamp.toDate() : new Date(0);
                            return dateB.getTime() - dateA.getTime();
                        });


                        userInvestmentsData.forEach((investment) => {
                            const investDate = investment.timestamp && investment.timestamp.toDate ? new Date(investment.timestamp.toDate()) : new Date();
                            const formattedInvestDate = investDate.toLocaleDateString();

                            const card = `
                                <div class="investment-summary-card ${investment.planName === 'Standard Plan' ? 'standard-plan-item' :
                                                                           investment.planName === 'Premium 6-Month Plan' ? 'premium-plan-item' :
                                                                           'elite-plan-item'} clickable-investment-summary" data-id="${investment.id}">
                                    <div>
                                        <div class="plan-name">${investment.planName}</div>
                                        <div class="invest-date">Invested on: ${formattedInvestDate}</div>
                                    </div>
                                    <div class="arrow-icon">▶</div>
                                </div>
                            `;
                            if (investmentsContainer) investmentsContainer.insertAdjacentHTML('beforeend', card);
                        });
                        document.querySelectorAll('.clickable-investment-summary').forEach(card => {
                            card.addEventListener('click', (event) => {
                                const id = event.currentTarget.dataset.id;
                                showInvestmentDetail(id);
                            });
                        });
                        console.log("[Fetch Investments] Investments displayed.");
                    }
                }, (error) => {
                    console.error("[Fetch Investments Error]", error);
                    if (currentUserId && (auth && auth.currentUser && !auth.currentUser.isAnonymous)) {
                        if (investmentsContainer) investmentsContainer.innerHTML = '<p class="text-center text-red-500 col-span-full">Error loading investments. Please try again later.</p>';
                    }
                });
            }

            // --- Function to display individual investment details ---
            function showInvestmentDetail(id) {
                const investment = userInvestmentsData.find(inv => inv.id === id);

                if (!investment) {
                    showMessage('Error', 'Investment details not found.', false);
                    return;
                }

                console.log("[Investment Detail] Displaying investment object:", investment);

                let monthlyReturnRate = 0;
                let lockInMonths = 0;
                let bonusPercentage = 0;
                let payoutFrequencyText = ""; // To store "Monthly" or "One-Time (after lock-in)"

                // Dynamically get plan details from the HTML cards
                const correspondingPlanCard = Array.from(planCards).find(card =>
                    card.dataset.planName === investment.planName
                );

                if (correspondingPlanCard) {
                    monthlyReturnRate = parseFloat(correspondingPlanCard.dataset.monthlyReturn.replace('%', '')) / 100;
                    // Parse lock-in period from string like "2 months minimum" or "6 months"
                    lockInMonths = parseInt(correspondingPlanCard.dataset.lockIn.split(' ')[0]);
                    payoutFrequencyText = correspondingPlanCard.dataset.payoutFrequency;

                    if (correspondingPlanCard.dataset.planName === "Premium 6-Month Plan") {
                        bonusPercentage = 0.04; // Updated to 4%
                    } else if (correspondingPlanCard.dataset.planName === "Elite 12-Month Plan") {
                        bonusPercentage = 0.06; // Updated to 6%
                    }
                } else {
                    console.warn(`[Investment Detail] No corresponding plan card found for ${investment.planName}. Calculations might be inaccurate.`);
                    monthlyReturnRate = parseFloat(investment.monthlyReturn.replace('%', '')) / 100 || 0;
                    // Default to monthly for older records if card not found and assume no bonus
                    payoutFrequencyText = "Monthly";
                }

                let monthlyPayoutDisplay = "";
                let totalProjectedReturn = 0;

                if (investment.planName === "Standard Plan") {
                    // For Standard Plan, monthly returns accrue but payout is one-time
                    monthlyPayoutDisplay = `₹${(parseFloat(investment.amount) * monthlyReturnRate).toFixed(2)} (Accrued Monthly)`;
                    totalProjectedReturn = parseFloat(investment.amount) * (1 + (monthlyReturnRate * lockInMonths));
                } else {
                    // For Premium and Elite, monthly payouts occur
                    monthlyPayoutDisplay = `₹${(parseFloat(investment.amount) * monthlyReturnRate).toFixed(2)}`;
                    totalProjectedReturn = parseFloat(investment.amount) * (1 + (monthlyReturnRate * lockInMonths) + bonusPercentage);
                }

                // Apply limited time offer bonus for Premium 6-Month Plan if applicable
                if (investment.planName === "Premium 6-Month Plan") {
                    // This calculation is for display only, not for actual bonus earning logic
                    // The actual bonus earning for the limited time offer is handled by the Cloud Function
                    const now = new Date();
                    const todayStart = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 0, 0, 0); // 12 AM today
                    const offerEndDateForCalculation = new Date(todayStart.getTime() + (7 * 24 * 60 * 60 * 1000)); // 7 days from 12 AM today

                    if (now < offerEndDateForCalculation) { // Check against the fixed offerEndDate
                        // This part is for display only, the actual bonus calculation is on the server
                        // For the calculator, we'll reflect the potential bonus if the offer is active
                        // This should ideally be handled by a server-side check for actual bonus application
                        // but for client-side display, we simulate it.
                    }
                }


                const investDate = investment.timestamp && investment.timestamp.toDate ? new Date(investment.timestamp.toDate()) : new Date();
                const formattedInvestDate = investDate.toLocaleDateString();

                const planEndDate = new Date(investDate);
                planEndDate.setMonth(planEndDate.getMonth() + lockInMonths);
                const formattedPlanEndDate = planEndDate.toLocaleDateString();

                // For Standard plan, payout is at the end of the lock-in period
                let payoutReturnDate;
                if (investment.planName === "Standard Plan") {
                    payoutReturnDate = new Date(planEndDate); // Principal + returns paid at lock-in end
                } else {
                    // For others, it's end of month after lock-in
                    payoutReturnDate = new Date(planEndDate.getFullYear(), planEndDate.getMonth() + 1, 0);
                }
                const formattedPayoutReturnDate = payoutReturnDate.toLocaleDateString();


                detailModalPlanName.textContent = investment.planName;
                detailInvestedAmount.textContent = `₹${parseFloat(investment.amount).toFixed(2)}`;
                detailMonthlyPayout.textContent = monthlyPayoutDisplay; // Use the adjusted display text
                detailProjectedTotalReturn.textContent = `₹${totalProjectedReturn.toFixed(2)}`;
                detailInvestDate.textContent = formattedInvestDate;
                detailPlanEndDate.textContent = formattedPlanEndDate;
                detailPayoutReturnDate.textContent = formattedPayoutReturnDate;
                // Removed all lines that set text content for UTR, UPI, Bank Account details
                // The financial-details-group div is now removed from HTML, so no need to hide/show its rows.

                console.log("[Investment Detail] Modal populated and opened.");

                closeModal(myInvestmentsModal);
                openModal(investmentDetailsModal);
            }


            // --- Section Reveal Animation Logic ---
            const sectionsToAnimate = document.querySelectorAll('section:not(#hero):not(.modal-overlay)');

            const isInViewport = (element) => {
                const rect = element.getBoundingClientRect();
                return (
                    rect.top < (window.innerHeight || document.documentElement.clientHeight) * 0.8 &&
                    rect.bottom > 0
                );
            };

            const revealSections = () => {
                sectionsToAnimate.forEach(section => {
                    if (isInViewport(section)) {
                        section.classList.remove('section-hidden');
                        section.classList.add('section-visible');
                    }
                });
            };

            sectionsToAnimate.forEach(section => {
                section.classList.add('section-hidden');
            });

            revealSections();
            window.addEventListener('scroll', revealSections);

            // --- Countdown Timer Logic (7 days from 12 AM today) ---
            // Define offerEndDate ONCE when the script loads
            const now = new Date();
            // Set the current date to 12 AM
            const todayStart = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 0, 0, 0);
            // Calculate the offer end date as 7 days from today's 12 AM
            const offerEndDate = new Date(todayStart.getTime() + (7 * 24 * 60 * 60 * 1000)); // 7 days from 12 AM today

            const updateCountdown = () => {
                const currentTime = new Date();
                const totalSeconds = (offerEndDate.getTime() - currentTime.getTime()) / 1000; // Use getTime() for consistency

                if (totalSeconds < 0) {
                    if (countdownElement) countdownElement.textContent = "Offer Expired!";
                    if (offerTimePeriodSpan) offerTimePeriodSpan.textContent = "the offer period"; // Update text when expired
                    return;
                }

                const days = Math.floor(totalSeconds / (3600 * 24));
                const hours = Math.floor((totalSeconds % (3600 * 24)) / 3600);
                const minutes = Math.floor((totalSeconds % 3600) / 60);
                const seconds = Math.floor(totalSeconds % 60);

                if (countdownElement) countdownElement.textContent = `${days}d ${hours}h ${minutes}m ${seconds}s`;
            };

            setInterval(updateCountdown, 1000);
            updateCountdown(); // Call immediately to show initial countdown


            // --- Investment Calculator Logic ---
            calculateBtn?.addEventListener('click', async () => {
                const amount = parseFloat(investmentAmountInput.value);
                const plan = investmentPlanSelect.value;
                let monthlyReturnRate = 0;
                let lockInMonths = 0;
                let planName = "";
                let bonusPercentage = 0;
                let payoutType = ""; // To store "Monthly" or "One-Time (after lock-in)"

                let selectedPlanCard = null;
                for (let i = 0; i < planCards.length; i++) {
                    if (planCards[i].dataset.planName.toLowerCase().includes(plan)) {
                        selectedPlanCard = planCards[i];
                        break;
                    }
                }

                if (!selectedPlanCard) {
                    console.error("[Calculator] Selected plan card not found for calculation.");
                    showMessage('Calculation Error', 'Could not find details for the selected plan.', false);
                    return;
                }

                monthlyReturnRate = parseFloat(selectedPlanCard.dataset.monthlyReturn.replace('%', '')) / 100;
                payoutType = selectedPlanCard.dataset.payoutFrequency;


                if (isNaN(amount) || amount <= 0) {
                    if (resultsDiv) resultsDiv.classList.remove('hidden');
                    if (displayInitialInvestment) displayInitialInvestment.textContent = `Invalid amount.`;
                    if (displayTotalReturn) displayTotalReturn.textContent = `Invalid amount.`;
                    if (displayPercentageReturn) displayPercentageReturn.textContent = `Invalid amount.`;
                    return;
                }

                const MAX_INVESTMENT_AMOUNT_CALCULATOR = 10000;
                if (amount > MAX_INVESTMENT_AMOUNT_CALCULATOR) {
                    if (resultsDiv) resultsDiv.classList.remove('hidden');
                    if (displayInitialInvestment) displayInitialInvestment.textContent = `₹${amount.toFixed(2)}`;
                    if (displayTotalReturn) displayTotalReturn.textContent = 'N/A';
                    if (displayPercentageReturn) displayPercentageReturn.displayPercentageReturn = 'N/A';
                    showMessage('Investment Limit', `Investment amount cannot exceed ₹${MAX_INVESTMENT_AMOUNT_CALCULATOR}.`, false);
                    return;
                }


                let calculatedTotalReturn = 0;
                if (plan === 'standard') {
                    lockInMonths = 2;
                    calculatedTotalReturn = amount * (1 + (monthlyReturnRate * lockInMonths));
                    planName = "Standard Plan";
                } else if (plan === 'premium') {
                    lockInMonths = 6;
                    bonusPercentage = 0.04; // Updated to 4%
                    
                    // Use the globally defined, fixed offerEndDate for calculation
                    const now = new Date();
                    let additionalOfferBonus = 0;
                    if (now < offerEndDate) { // Check against the fixed offerEndDate
                        additionalOfferBonus = 0.05; // Limited time offer bonus
                    }
                    calculatedTotalReturn = amount * (1 + (monthlyReturnRate * lockInMonths) + bonusPercentage + additionalOfferBonus);
                    planName = "Premium 6-Month Plan";
                } else if (plan === 'elite') {
                    lockInMonths = 12;
                    bonusPercentage = 0.06; // Updated to 6%
                    calculatedTotalReturn = amount * (1 + (monthlyReturnRate * lockInMonths) + bonusPercentage);
                    planName = "Elite 12-Month Plan";
                    if (amount < 1000) {
                         if (resultsDiv) resultsDiv.classList.remove('hidden');
                         if (displayInitialInvestment) displayInitialInvestment.textContent = `₹${amount.toFixed(2)}`;
                         if (displayTotalReturn) displayTotalReturn.textContent = 'N/A';
                         if (displayPercentageReturn) displayPercentageReturn.textContent = 'N/A';
                         showMessage('Minimum Investment', 'The Elite 12-Month Plan requires a minimum investment of ₹1000.', false);
                         return;
                    }
                }

                const percentageReturn = ((calculatedTotalReturn - amount) / amount) * 100;

                console.log(`[Calculator] Amount: ${amount}, Plan: ${planName}, Monthly Rate: ${monthlyReturnRate}, Calculated Total Return: ${calculatedTotalReturn.toFixed(2)}, Percentage Return: ${percentageReturn.toFixed(2)}%`);

                if (displayInitialInvestment) displayInitialInvestment.textContent = `₹${amount.toFixed(2)}`;
                if (displayTotalReturn) displayTotalReturn.textContent = `₹${calculatedTotalReturn.toFixed(2)}`;
                if (displayPercentageReturn) displayPercentageReturn.textContent = `${percentageReturn.toFixed(2)}%`;
                if (resultsDiv) resultsDiv.classList.remove('hidden');
            });

            // --- Plan Detail Modal Functionality ---
            const modalReferralInfo = document.getElementById('modalReferralInfo');
            const modalReferralText = document.getElementById('modalReferralText');

            planCards.forEach(card => {
                card.addEventListener('click', () => {
                    const planName = card.dataset.planName;
                    const monthlyReturn = card.dataset.monthlyReturn;
                    const minInvestment = parseFloat(card.dataset.minInvestment);
                    const payoutFrequency = card.dataset.payoutFrequency;
                    const lockIn = card.dataset.lockIn;
                    const benefitsRaw = card.dataset.benefits;
                    const totalReturn = card.dataset.totalReturn;

                    // Get referral bonus data attributes
                    const referralBonusStandard = card.dataset.referralBonusStandard;
                    const referralBonusPremium = card.dataset.referralBonusPremium;
                    const referralBonusElite = card.dataset.referralBonusElite;

                    selectedPlanDetails = {
                        planName: planName,
                        monthlyReturn: monthlyReturn,
                        minInvestment: minInvestment,
                        payoutFrequency: payoutFrequency,
                        lockIn: lockIn,
                        benefits: benefitsRaw,
                        totalReturn: totalReturn,
                        referralBonusStandard: referralBonusStandard,
                        referralBonusPremium: referralBonusPremium,
                        referralBonusElite: referralBonusElite
                    };
                    console.log("[Plan Detail Modal] Selected plan details:", selectedPlanDetails);

                    if (document.getElementById('modalPlanName')) document.getElementById('modalPlanName').textContent = planName;
                    if (document.getElementById('modalMonthlyReturn')) document.getElementById('modalMonthlyReturn').textContent = monthlyReturn;
                    if (document.getElementById('modalMinInvestment')) document.getElementById('modalMinInvestment').textContent = minInvestment.toFixed(2);
                    if (document.getElementById('modalPayoutFrequency')) document.getElementById('modalPayoutFrequency').textContent = payoutFrequency;
                    if (document.getElementById('modalLockIn')) document.getElementById('modalLockIn').textContent = lockIn;
                    if (document.getElementById('modalTotalReturn')) document.getElementById('modalTotalReturn').textContent = totalReturn;

                    const benefitsList = document.getElementById('modalBenefits');
                    if (benefitsList) {
                        benefitsList.innerHTML = '';
                        try {
                            const benefits = JSON.parse(benefitsRaw);
                            const specialOffers = benefits.filter(benefit => benefit.includes("Bonus:") || benefit.includes("Total Return:"));
                            const exclusivePerks = benefits.filter(benefit => benefit.includes("Priority Support.") || benefit.includes("Referral Bonus:") || benefit.includes("Annual Investment Report:"));
                            const generalBenefits = benefits.filter(benefit => !specialOffers.includes(benefit) && !exclusivePerks.includes(benefit));

                            if (specialOffers.length > 0) {
                                const h4Offer = document.createElement('h4');
                                h4Offer.className = 'text-xl font-semibold text-gray-700 mb-2 mt-4';
                                h4Offer.textContent = 'SPECIAL OFFER:';
                                benefitsList.appendChild(h4Offer);
                                specialOffers.forEach(benefit => {
                                    const li = document.createElement('li');
                                    li.textContent = benefit;
                                    benefitsList.appendChild(li);
                                });
                            }

                            if (exclusivePerks.length > 0) {
                                const h4Perks = document.createElement('h4');
                                h4Perks.className = 'text-xl font-semibold text-gray-700 mb-2 mt-4';
                                h4Perks.textContent = 'Exclusive Perks:';
                                benefitsList.appendChild(h4Perks);
                                exclusivePerks.forEach(benefit => {
                                    const li = document.createElement('li');
                                    li.textContent = benefit;
                                    benefitsList.appendChild(li);
                                });
                            }

                            if (generalBenefits.length > 0) {
                                const h4Benefits = document.createElement('h4');
                                h4Benefits = document.createElement('h4');
                                h4Benefits.className = 'text-xl font-semibold text-gray-700 mb-2';
                                h4Benefits.textContent = 'Benefits:';
                                benefitsList.appendChild(h4Benefits);
                                generalBenefits.forEach(benefit => {
                                    const li = document.createElement('li');
                                    li.textContent = benefit;
                                    benefitsList.appendChild(li);
                                });
                            }


                        } catch (e) {
                            console.error("[Plan Detail Modal] Error parsing benefits:", e);
                            const li = document.createElement('li');
                            li.textContent = "Benefits information unavailable.";
                            benefitsList.appendChild(li);
                        }
                    }

                    // Populate and show/hide referral info
                    if (planName === "Standard Plan") {
                        if (modalReferralInfo) modalReferralInfo.classList.remove('hidden'); // Standard plan now has referral
                        if (modalReferralText) {
                            let referralText = `When you refer an investor: <br>- For any plan: ${referralBonusStandard} of their investment`;
                            modalReferralText.innerHTML = referralText;
                        }
                    } else {
                        if (modalReferralInfo) modalReferralInfo.classList.remove('hidden');
                        if (modalReferralText) {
                            let referralText = `When you refer an investor:`;
                            if (referralBonusStandard) referralText += `<br>- If they take Standard Plan: ${referralBonusStandard} of their investment`;
                            if (referralBonusPremium) referralText += `<br>- If they take 6-Month Plan: ${referralBonusPremium} of their investment`;
                            if (referralBonusElite) referralText += `<br>- If they take 12-Month Plan: ${referralBonusElite} of their investment`;
                            modalReferralText.innerHTML = referralText;
                        }
                    }

                    openModal(planDetailModal);
                });
            });

            if (closePlanDetailModalBtn) {
                closePlanDetailModalBtn.addEventListener('click', () => {
                    closeModal(planDetailModal);
                });
            }

            if (planDetailModal) {
                planDetailModal.addEventListener('click', (e) => {
                    if (e.target === planDetailModal) {
                        closeModal(planDetailModal);
                    }
                });
            }


            // --- Invest Now Button (from Plan Detail Modal) now opens the Invest Form Modal ---
            if (investNowBtn) {
                investNowBtn.addEventListener('click', () => {
                    if (!currentUserId || (auth && auth.currentUser && auth.currentUser.isAnonymous)) {
                        showMessage('Authentication Required', 'Please sign in or sign up to invest. Anonymous users cannot submit investments.', false);
                        closeModal(planDetailModal);
                        openModal(signInModal);
                        return;
                    }
                    closeModal(planDetailModal);
                    openModal(investModal);
                    if (investFormPlanName) investFormPlanName.textContent = selectedPlanDetails.planName;
                    if (invPlanHiddenInput) invPlanHiddenInput.value = selectedPlanDetails.planName;
                    if (invAmountInput) {
                        invAmountInput.value = selectedPlanDetails.minInvestment;
                        invAmountInput.min = selectedPlanDetails.minInvestment;
                        if (invAmountValidationMessage) {
                             invAmountValidationMessage.textContent = `Minimum ₹${selectedPlanDetails.minInvestment}, in multiples of ₹100. Maximum ₹10,000.`
                        }
                        // NEW: Generate QR and deep links when invest modal opens
                        generateUpiPaymentOptions(selectedPlanDetails.minInvestment);
                    }
                    if (invEmailInput && currentUserEmail) invEmailInput.value = currentUserEmail;
                });
            }

            // --- Copy UPI ID functionality ---
            document.querySelectorAll('.copy-upi-btn, .copy-btn-small').forEach(button => { // Added .copy-btn-small
                button.addEventListener('click', (e) => {
                    const upiIdToCopy = e.target.dataset.upi || document.getElementById(e.target.dataset.copyTarget)?.textContent;
                    if (!upiIdToCopy) {
                        showMessage('Copy Failed', 'Nothing to copy.', false);
                        return;
                    }
                    const tempInput = document.createElement('input');
                    document.body.appendChild(tempInput);
                    tempInput.value = upiIdToCopy;
                    tempInput.select();
                    try {
                        document.execCommand('copy');
                        showMessage('Copied!', 'ID copied to clipboard.', true);
                    } catch (err) {
                        console.error('[Copy UPI] Failed to copy text: ', err);
                        showMessage('Copy Failed', 'Could not copy ID. Please copy it manually.', false);
                    }
                    document.body.removeChild(tempInput);
                });
            });

            // --- NEW: Generate UPI Deep Link and QR Code ---
            function generateUpiPaymentOptions(amount) {
                // Randomly pick one UPI ID for this specific payment instance
                const selectedCompanyUpi = companyUpiIds[Math.floor(Math.random() * companyUpiIds.length)];

                const payeeName = "ADS FUND";
                const transactionNote = `Investment for ${selectedPlanDetails.planName}`;
                const upiDeepLink = `upi://pay?pa=${selectedCompanyUpi.id}&pn=${encodeURIComponent(payeeName)}&am=${amount}&tn=${encodeURIComponent(transactionNote)}&cu=INR`;
                
                // Set QR code source
                if (upiQrCodeImg) {
                    upiQrCodeImg.src = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(upiDeepLink)}`;
                }

                // Attach deep link to UPI app buttons
                upiAppButtons.forEach(button => {
                    button.onclick = () => {
                        // For demonstration, we'll use a generic deep link.
                        // In a real scenario, you might construct app-specific deep links.
                        // For now, just open the generic UPI deep link.
                        window.location.href = upiDeepLink;
                    };
                });
            }

            // --- Investment Form Modal Logic ---
            closeInvestModalBtn?.addEventListener('click', () => closeModal(investModal));
            cancelInvestFormBtn?.addEventListener('click', () => closeModal(investModal));

            investmentForm?.addEventListener('submit', async (e) => {
                e.preventDefault();
                console.log("[Investment Form] Submission started.");

                if (!acceptTermsCheckbox || !acceptTermsCheckbox.checked) {
                    showMessage('Agreement Required', 'You must accept the Terms & Conditions to proceed with your investment.', false);
                    return;
                }

                if (submitInvestmentBtn) {
                    submitInvestmentBtn.disabled = true;
                    submitInvestmentBtn.textContent = 'Processing...';
                }

                const name = invNameInput.value.trim();
                const email = invEmailInput.value.trim();
                const mobile = invMobileInput.value.trim();
                const amount = parseFloat(invAmountInput.value);
                const paidUpiId = paidUpiIdSelect.value;
                const utrNumber = invUtrNumberInput.value.trim();
                const planName = invPlanHiddenInput.value.trim();

                console.log(`[Investment Form] Collected data: Name=${name}, Email=${email}, Amount=${amount}, Plan=${planName}, Paid UPI ID=${paidUpiId}, UTR=${utrNumber}`);

                if (!name || !email || !mobile || !utrNumber || !planName || isNaN(amount) || !paidUpiId) {
                    showMessage('Missing Information', 'Please fill in all required fields and ensure investment amount is valid.', false);
                    if (submitInvestmentBtn) {
                        submitInvestmentBtn.disabled = false;
                        submitInvestmentBtn.textContent = 'Submit Investment';
                    }
                    return;
                }

                if (!/^\d{12}$/.test(utrNumber)) {
                    showMessage('Invalid UTR Number', 'UTR Number must be exactly 12 digits.', false);
                    if (submitInvestmentBtn) {
                        submitInvestmentBtn.disabled = false;
                        submitInvestmentBtn.textContent = 'Submit Investment';
                    }
                    return;
                }

                if (amount < selectedPlanDetails.minInvestment || (amount % 100 !== 0)) {
                    showMessage('Invalid Amount', `Investment amount must be at least ₹${selectedPlanDetails.minInvestment} and in multiples of ₹100.`, false);
                    if (submitInvestmentBtn) {
                        submitInvestmentBtn.disabled = false;
                        submitInvestmentBtn.textContent = 'Submit Investment';
                    }
                    return;
                }

                const MAX_INVESTMENT_AMOUNT = 10000;
                if (amount > MAX_INVESTMENT_AMOUNT) {
                    showMessage('Investment Limit Exceeded', `Investment amount cannot exceed ₹${MAX_INVESTMENT_AMOUNT}.`, false);
                    if (submitInvestmentBtn) {
                        submitInvestmentBtn.disabled = false;
                        submitInvestmentBtn.textContent = 'Submit Investment';
                    }
                    return;
                }

                if (!currentUserId || (auth && auth.currentUser && auth.currentUser.isAnonymous)) {
                     showMessage('Authentication Error', 'You must be signed in with a registered account to submit an investment, and Firebase services must be ready.', false);
                     if (submitInvestmentBtn) {
                        submitInvestmentBtn.disabled = false;
                        submitInvestmentBtn.textContent = 'Submit Investment';
                    }
                     return;
                }

                // --- NEW: Fetch current user's bank details from their profile ---
                const userDocRef = doc(db, `artifacts/${appId}/users/${currentUserId}`);
                const userDocSnap = await getDoc(userDocRef);
                let bankDetailsForInvestment = {};
                if (userDocSnap.exists()) {
                    const userData = userDocSnap.data();
                    bankDetailsForInvestment = userData.bankDetails || {}; // Get existing bank details
                } else {
                    showMessage('Bank Details Missing', 'Your bank details are not found in your profile. Please add them in the "Bank Card" section before investing.', false);
                    if (submitInvestmentBtn) {
                        submitInvestmentBtn.disabled = false;
                        submitInvestmentBtn.textContent = 'Submit Investment';
                    }
                    return;
                }

                // Validate if essential bank details are present
                if (!bankDetailsForInvestment.accountName || !bankDetailsForInvestment.accountNumber || !bankDetailsForInvestment.ifscCode) {
                    showMessage('Bank Details Incomplete', 'Please ensure your bank account name, number, and IFSC code are saved in the "Bank Card" section before investing.', false);
                     if (submitInvestmentBtn) {
                        submitInvestmentBtn.disabled = false;
                        submitInvestmentBtn.textContent = 'Submit Investment';
                    }
                    return;
                }

                try {
                    const userInvestmentsCollectionRef = collection(db, `artifacts/${appId}/users/${currentUserId}/investments`);
                    await addDoc(userInvestmentsCollectionRef, {
                        userId: currentUserId,
                        customUserId: currentUserCustomId,
                        name: name,
                        email: email,
                        mobile: mobile,
                        amount: amount,
                        planName: planName,
                        monthlyReturn: selectedPlanDetails.monthlyReturn, // Store the monthly return rate as a string (e.g., "5%")
                        paidUpiId: paidUpiId,
                        utrNumber: utrNumber,
                        // Include fetched bank details here
                        bankAccountName: bankDetailsForInvestment.accountName || 'N/A',
                        bankAccount: bankDetailsForInvestment.accountNumber || 'N/A',
                        ifscCode: bankDetailsForInvestment.ifscCode || 'N/A',
                        upiIdOptional: bankDetailsForInvestment.upiId || null, // Can be null if not provided
                        timestamp: serverTimestamp()
                    });
                    console.log(`[Investment Form] Investment successfully added for user ${currentUserId}.`);

                    showMessage('Investment Submitted!', `Your investment in the ${planName} of ₹${amount.toFixed(2)} has been recorded. We will verify the UTR number shortly.`, true);
                    closeModal(investModal);
                    investmentForm.reset();
                    if (acceptTermsCheckbox) acceptTermsCheckbox.checked = false;

                }
                catch (error) {
                    console.error("[Investment Submission Error]", error);
                    showMessage('Submission Failed', `An error occurred: ${error.message}`, false);
                } finally {
                    if (submitInvestmentBtn) {
                        submitInvestmentBtn.disabled = false;
                        submitInvestmentBtn.textContent = 'Submit Investment';
                    }
                }
            });

            // --- NEW: Populate Bank Details Form ---
            function populateBankDetailsForm() {
                console.log("[Bank Card Modal] Populating form with current user bank details:", currentUserBankDetails);

                const hasBankDetails = currentUserBankDetails.accountName && currentUserBankDetails.accountNumber && currentUserBankDetails.ifscCode;

                if (bankAccountNameInput) bankAccountNameInput.value = currentUserBankDetails.accountName || '';
                if (bankAccountNumberInput) bankAccountNumberInput.value = currentUserBankDetails.accountNumber || '';
                if (ifscCodeInput) ifscCodeInput.value = currentUserBankDetails.ifscCode || '';
                if (upiIdOptionalInput) upiIdOptionalInput.value = currentUserBankDetails.upiId || '';

                if (hasBankDetails) {
                    // Disable inputs
                    if (bankAccountNameInput) bankAccountNameInput.disabled = true;
                    if (bankAccountNumberInput) bankAccountNumberInput.disabled = true;
                    if (ifscCodeInput) ifscCodeInput.disabled = true;
                    if (upiIdOptionalInput) upiIdOptionalInput.disabled = true;

                    // Hide save button, show message
                    if (bankDetailsFormButtons) bankDetailsFormButtons.classList.add('hidden');
                    if (bankDetailsSavedMessage) bankDetailsSavedMessage.classList.remove('hidden');
                    if (bankDetailsInstructionText) bankDetailsInstructionText.classList.add('hidden'); // Hide initial instruction
                } else {
                    // Enable inputs
                    if (bankAccountNameInput) bankAccountNameInput.disabled = false;
                    if (bankAccountNumberInput) bankAccountNumberInput.disabled = false;
                    if (ifscCodeInput) ifscCodeInput.disabled = false;
                    if (upiIdOptionalInput) upiIdOptionalInput.disabled = false;

                    // Show save button, hide message
                    if (bankDetailsFormButtons) bankDetailsFormButtons.classList.remove('hidden');
                    if (bankDetailsSavedMessage) bankDetailsSavedMessage.classList.add('hidden');
                    if (bankDetailsInstructionText) bankDetailsInstructionText.classList.remove('hidden'); // Show initial instruction
                }
            }

            // --- NEW: Save Bank Details Form Submission ---
            bankCardForm?.addEventListener('submit', async (e) => {
                e.preventDefault();
                console.log("[Bank Card Form] Submission started."); // Log 1

                // Prevent submission if inputs are disabled (meaning details are already saved)
                if (bankAccountNameInput && bankAccountNameInput.disabled) {
                    console.log("[Bank Card Form] Attempted to submit disabled form. Blocking.");
                    return;
                }

                if (!currentUserId || (auth && auth.currentUser && auth.currentUser.isAnonymous)) {
                    console.log("[Bank Card Form] Authentication check failed. User not logged in or is anonymous."); // Log 2
                    showMessage('Authentication Required', 'Please sign in to save your bank details.', false);
                    if (saveBankDetailsBtn) {
                        saveBankDetailsBtn.disabled = false;
                        saveBankDetailsBtn.textContent = 'Save Bank Details';
                    }
                    return;
                }

                if (saveBankDetailsBtn) {
                    saveBankDetailsBtn.disabled = true;
                    saveBankDetailsBtn.textContent = 'Saving...';
                }

                const accountName = bankAccountNameInput.value.trim();
                const accountNumber = bankAccountNumberInput.value.trim();
                const ifscCode = ifscCodeInput.value.trim();
                const upiId = upiIdOptionalInput.value.trim();

                console.log(`[Bank Card Form] Collected data: Account Name=${accountName}, Account Number=${accountNumber}, IFSC=${ifscCode}, UPI ID=${upiId}`); // Log 3

                if (!accountName || !accountNumber || !ifscCode) {
                    console.log("[Bank Card Form] Validation failed: Missing required fields."); // Log 4
                    showMessage('Missing Information', 'Please fill in all required bank details (Account Name, Account Number, IFSC Code).', false);
                    if (saveBankDetailsBtn) {
                        saveBankDetailsBtn.disabled = false;
                        saveBankDetailsBtn.textContent = 'Save Bank Details';
                    }
                    return;
                }

                // Basic validation for account number and IFSC (can be enhanced)
                if (!/^\d+$/.test(accountNumber)) {
                    console.log("[Bank Card Form] Validation failed: Invalid Account Number."); // Log 5
                    showMessage('Invalid Account Number', 'Bank Account Number should contain only digits.', false);
                    if (saveBankDetailsBtn) {
                        saveBankDetailsBtn.disabled = false;
                        saveBankDetailsBtn.textContent = 'Save Bank Details';
                    }
                    return;
                }
                if (!/^[A-Z]{4}0[A-Z0-9]{6}$/.test(ifscCode)) {
                    console.log("[Bank Card Form] Validation failed: Invalid IFSC Code."); // Log 6
                    showMessage('Invalid IFSC Code', 'IFSC Code format is incorrect (e.g., ABCD0123456).', false);
                    if (saveBankDetailsBtn) {
                        saveBankDetailsBtn.disabled = false;
                        saveBankDetailsBtn.textContent = 'Save Bank Details';
                    }
                    return;
                }


                try {
                    const userDocRef = doc(db, `artifacts/${appId}/users/${currentUserId}`);
                    console.log(`[Bank Card Form] Attempting to update document at path: artifacts/${appId}/users/${currentUserId}`); // Log 7
                    await updateDoc(userDocRef, {
                        bankDetails: {
                            accountName: accountName,
                            accountNumber: accountNumber,
                            ifscCode: ifscCode,
                            upiId: upiId || null // Store as null if empty
                        }
                    });
                    console.log(`[Bank Card Form] Bank details saved for user ${currentUserId}.`); // Log 8
                    showMessage('Bank Details Saved!', 'Your bank details have been successfully updated.', true);
                    // After successful save, re-populate to make it read-only
                    populateBankDetailsForm();
                    // closeModal(bankCardModal); // Don't close, just make read-only
                } catch (error) {
                    console.error("[Bank Card Form Submission Error]", error); //  Log 9
                    let errorMessage = error.message;
                    if (error.code === 'permission-denied') {
                        errorMessage = 'Permission denied. Please check your Firebase Security Rules for user documents. Ensure authenticated users can write to their own user document.';
                    }
                    showMessage('Save Failed', `An error occurred while saving bank details: ${errorMessage}`, false);
                } finally {
                    if (saveBankDetailsBtn) {
                        saveBankDetailsBtn.disabled = false;
                        saveBankDetailsBtn.textContent = 'Save Bank Details';
                    }
                }
            });

            // --- NEW: Fetch and Display Payment History ---
            function fetchPaymentHistory() {
                if (!isAuthReady || !currentUserId || (auth && auth.currentUser && auth.currentUser.isAnonymous) || !db) {
                    console.log("[Fetch Payment History] Auth not ready, not a registered user, anonymous, or Firestore is not ready. Cannot fetch payment history.");
                    if (paymentHistoryContainer && noPaymentHistoryMessage) {
                        paymentHistoryContainer.innerHTML = '';
                        if (noPaymentHistoryMessage.parentNode !== paymentHistoryContainer) {
                            paymentHistoryContainer.appendChild(noPaymentHistoryMessage);
                        }
                        noPaymentHistoryMessage.textContent = 'Please sign in to view your payment history.';
                        noPaymentHistoryMessage.style.display = 'block';
                    }
                    return;
                }

                if (paymentHistoryContainer) {
                    paymentHistoryContainer.innerHTML = '<p class="text-center text-lg text-gray-600">Loading payment history...</p>';
                    noPaymentHistoryMessage.style.display = 'none';
                }
                console.log(`[Fetch Payment History] Attempting to fetch payments for user UID: ${currentUserId} in path: artifacts/${appId}/users/${currentUserId}/investments`);

                const userInvestmentsRef = collection(db, `artifacts/${appId}/users/${currentUserId}/investments`);
                const q = query(userInvestmentsRef); // No orderBy to avoid index issues

                if (unsubscribePaymentHistory) {
                    unsubscribePaymentHistory();
                    console.log("[Fetch Payment History] Unsubscribed from previous payment history listener.");
                }

                unsubscribePaymentHistory = onSnapshot(q, (snapshot) => {
                    userPaymentHistoryData = [];
                    if (snapshot.empty) {
                        console.log("[Fetch Payment History] No payment history found for this user.");
                        if (paymentHistoryContainer && noPaymentHistoryMessage) {
                            paymentHistoryContainer.innerHTML = '';
                            if (noPaymentHistoryMessage.parentNode !== paymentHistoryContainer) {
                                paymentHistoryContainer.appendChild(noPaymentHistoryMessage);
                            }
                            noPaymentHistoryMessage.textContent = 'No payment history found.';
                            noPaymentHistoryMessage.style.display = 'block';
                        }
                    } else {
                        if (paymentHistoryContainer) paymentHistoryContainer.innerHTML = '';
                        noPaymentHistoryMessage.style.display = 'none';
                        snapshot.forEach((doc) => {
                            const payment = doc.data();
                            payment.id = doc.id;
                            userPaymentHistoryData.push(payment);
                            console.log(`[Fetch Payment History] Fetched payment:`, payment);
                        });

                        // Sort by timestamp descending (most recent first)
                        userPaymentHistoryData.sort((a, b) => {
                            const dateA = a.timestamp && a.timestamp.toDate ? a.timestamp.toDate() : new Date(0);
                            const dateB = b.timestamp && b.timestamp.toDate ? b.timestamp.toDate() : new Date(0);
                            return dateB.getTime() - dateA.getTime();
                        });

                        userPaymentHistoryData.forEach((payment) => {
                            const paymentDate = payment.timestamp && payment.timestamp.toDate ? new Date(payment.timestamp.toDate()) : new Date();
                            const formattedDateTime = paymentDate.toLocaleString('en-IN', {
                                year: 'numeric',
                                month: 'short',
                                day: 'numeric',
                                hour: '2-digit',
                                minute: '2-digit',
                                second: '2-digit',
                                hour12: true
                            });

                            const paymentItem = `
                                <div class="payment-item">
                                    <p><strong>Plan:</strong> ${payment.planName || 'N/A'}</p>
                                    <p class="amount"><strong>Amount:</strong> ₹${parseFloat(payment.amount).toFixed(2) || 'N/A'}</p>
                                    <p><strong>Paid To UPI ID:</strong> ${payment.paidUpiId || 'N/A'}</p>
                                    <p><strong>UTR Number:</strong> ${payment.utrNumber || 'N/A'}</p>
                                    <p class="date-time"><strong>Payment Time:</strong> ${formattedDateTime}</p>
                                </div>
                            `;
                            if (paymentHistoryContainer) paymentHistoryContainer.insertAdjacentHTML('beforeend', paymentItem);
                        });
                        console.log("[Fetch Payment History] Payment history displayed.");
                    }
                }, (error) => {
                    console.error("[Fetch Payment History Error]", error);
                    if (currentUserId && (auth && auth.currentUser && !auth.currentUser.isAnonymous)) {
                        if (paymentHistoryContainer) paymentHistoryContainer.innerHTML = '<p class="text-center text-red-500">Error loading payment history. Please try again later.</p>';
                    }
                });
            }


            // --- Event listener for "Explore Our Plans" button ---
            if (explorePlansBtn) {
                explorePlansBtn.addEventListener('click', (event) => {
                    event.preventDefault();

                    const plansSection = document.getElementById('plans');
                    if (plansSection) {
                        plansSection.scrollIntoView({ behavior: 'smooth' });

                        setTimeout(() => {
                            planCards.forEach((card, index) => {
                                card.classList.remove('animate-card-pop');
                                void card.offsetWidth;
                                setTimeout(() => {
                                    card.classList.add('animate-card-pop');
                                }, index * 100);
                            });
                        }, 800);
                    }
                });
            }
        });
    </script>
</body>
</html>
